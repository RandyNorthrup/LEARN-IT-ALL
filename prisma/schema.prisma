generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// Settings - Single user, just stores display name
model Settings {
  id          String   @id @default("settings")
  displayName String   @default("Learner")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

// Course Enrollment - Track which courses user has started
model CourseEnrollment {
  id                   String           @id @default(cuid())
  courseId             String           @unique
  status               EnrollmentStatus @default(IN_PROGRESS)
  completionPercentage Int              @default(0)
  enrolledAt           DateTime         @default(now())
  completedAt          DateTime?
  updatedAt            DateTime         @updatedAt

  @@map("course_enrollments")
}

// Lesson Progress - Track completion of individual lessons
model LessonProgress {
  id          String         @id @default(cuid())
  lessonId    String
  courseId    String
  status      ProgressStatus @default(NOT_STARTED)
  startedAt   DateTime?
  completedAt DateTime?
  timeSpent   Int?

  @@unique([lessonId])
  @@index([courseId])
  @@map("lesson_progress")
}

// Exercise Submission - Track code exercise attempts
model ExerciseSubmission {
  id          String           @id @default(cuid())
  exerciseId  String
  courseId    String
  code        String
  language    String
  status      SubmissionStatus @default(PENDING)
  score       Int              @default(0)
  feedback    String?
  submittedAt DateTime         @default(now())
  completedAt DateTime?
  testResults TestResult[]

  @@index([exerciseId])
  @@index([courseId])
  @@map("exercise_submissions")
}

// Test Result - Individual test case results for exercises
model TestResult {
  id             String             @id @default(cuid())
  submissionId   String
  testCaseId     String
  passed         Boolean
  expectedOutput String
  actualOutput   String?
  errorMessage   String?
  executionTime  Int?
  submission     ExerciseSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@index([submissionId])
  @@map("test_results")
}

// Quiz Attempt - Track quiz completions
model QuizAttempt {
  id          String       @id @default(cuid())
  quizId      String
  courseId    String
  score       Int
  passed      Boolean      @default(false)
  startedAt   DateTime     @default(now())
  completedAt DateTime?
  timeSpent   Int?
  answers     QuizAnswer[]

  @@index([quizId])
  @@index([courseId])
  @@map("quiz_attempts")
}

// Quiz Answer - Individual answers for quiz questions
model QuizAnswer {
  id           String      @id @default(cuid())
  attemptId    String
  questionId   String
  answer       String
  isCorrect    Boolean?
  pointsEarned Int         @default(0)
  attempt      QuizAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)

  @@index([attemptId])
  @@index([questionId])
  @@map("quiz_answers")
}

// Certificate - Earned certificates
model Certificate {
  id               String    @id @default(cuid())
  courseId         String?
  title            String
  description      String?
  verificationCode String    @unique
  issuedAt         DateTime  @default(now())
  expiresAt        DateTime?
  imageUrl         String?

  @@index([verificationCode])
  @@map("certificates")
}

enum SubmissionStatus {
  PENDING
  PASSED
  FAILED
}

enum EnrollmentStatus {
  IN_PROGRESS
  COMPLETED
  ABANDONED
}

enum ProgressStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}
