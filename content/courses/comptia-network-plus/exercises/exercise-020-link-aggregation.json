{
  "id": "exercise-020-link-aggregation",
  "lessonId": "lesson-020-link-aggregation",
  "title": "Link Aggregation: EtherChannel and LACP Configuration and Troubleshooting",
  "description": "You are a network engineer designing and implementing link aggregation solutions for your organization. Complete realistic scenarios involving EtherChannel configuration, LACP negotiation, load balancing decisions, and troubleshooting failed aggregations in multi-switch environments.",
  "difficulty": "advanced",
  "points": 100,
  "language": "cisco-ios",
  "starterCode": "# ============================================================================\n# NETWORK TOPOLOGY CONTEXT - MULTI-SWITCH ENVIRONMENT\n# ============================================================================\n# Your company is migrating from single-link switch connections to aggregated\n# links to eliminate bandwidth bottlenecks and provide redundancy.\n#\n#                    Core Switch (SW1)\n#                  (Distribution Layer)\n#                    /    |    |    \\\n#                   /     |    |     \\\n#           Gi0/1-4       Gi0/9   Gi0/17-20\n#             |             |         |\n#          [SW2]         [SW3]     [SW4]\n#        (Access)    (Access)   (Access)\n#          \n# Current State:\n# - SW1 to SW2: Single Gi0/1 link (1 Gbps) - BOTTLENECK\n# - SW1 to SW3: Single Gi0/9 link (1 Gbps) - BOTTLENECK  \n# - SW1 to SW4: Single Gi0/17 link (1 Gbps) - BOTTLENECK\n#\n# Goal: Implement link aggregation for redundancy and increased bandwidth\n# - SW1 to SW2: 4-link EtherChannel (aggregate 4 Gbps)\n# - SW1 to SW3: 2-link EtherChannel (aggregate 2 Gbps)\n# - SW1 to SW4: 3-link EtherChannel (aggregate 3 Gbps)\n#\n# ============================================================================\n\n# ============================================================================\n# SCENARIO 1: LINK AGGREGATION FUNDAMENTALS\n# ============================================================================\n# Your boss asks: \"Why do we need link aggregation instead of just adding\n# more individual links?\"\n#\n# TASK 1.1: Explain the traditional problem\n# Current network:\n# [Switch A] ---Gi0/1--- [Switch B]   \n# [Switch A] ---Gi0/2--- [Switch B]   (added for redundancy)\n# [Switch A] ---Gi0/3--- [Switch B]   (added for redundancy)\n#\n# Both links carry traffic? Yes / No __________\n#\n# Why not? __________\n# (Hint: What protocol blocks redundant links?)\n#\n# TASK 1.2: How does link aggregation solve this?\n# With EtherChannel:\n# [Switch A] ===4 Gbps aggregate=== [Switch B]\n#            (4x Gi0/1-4 bundled)\n#\n# All links active? Yes / No __________\n# Total bandwidth? __________ Gbps\n# Redundancy if one link fails? Yes / No __________\n#\n# TASK 1.3: Link aggregation benefits\n# Mark benefits as TRUE or FALSE:\n# 1. Increased bandwidth __________ \n# 2. Eliminates STP blocking __________ \n# 3. Requires new switch hardware __________\n# 4. Automatic failover if link down __________ \n# 5. Works with existing infrastructure __________\n# 6. Maintains packet order per flow __________ \n#\n\n# ============================================================================\n# SCENARIO 2: ETHERCHANNEL PROTOCOL SELECTION\n# ============================================================================\n# Your company has three switch models:\n# - Cisco 2960 (production switches) - support LACP and PAgP\n# - Juniper EX3400 (new core) - supports LACP only\n# - Arista 7050 (backup) - supports LACP only\n#\n# TASK 2.1: Which EtherChannel protocol to standardize?\n# Protocol: __________\n# Why? __________\n#\n# TASK 2.2: Protocol comparison\n# \n# PAgP (Port Aggregation Protocol):\n# - Vendor: __________ (proprietary)\n# - Standard: Yes / No __________\n# - Multi-vendor support: Yes / No __________\n# - Recommended for new deployments: Yes / No __________\n#\n# LACP (Link Aggregation Control Protocol):\n# - Standard: IEEE __________\n# - Vendor independent: Yes / No __________\n# - Works with Cisco, Juniper, Arista: Yes / No __________\n# - Recommended for new deployments: Yes / No __________\n#\n# Static/On Mode:\n# - Protocol negotiation: None / Required __________\n# - Risk of misconfiguration: High / Low __________\n# - Should be used for new designs: Yes / No __________\n#\n# TASK 2.3: Mode selection for LACP\n# Three options: Active, Passive, or Static\n# \n# Connection between SW1 and SW2:\n# Option 1: SW1=Active, SW2=Active → Channel forms? Yes / No __________\n# Option 2: SW1=Active, SW2=Passive → Channel forms? Yes / No __________\n# Option 3: SW1=Passive, SW2=Passive → Channel forms? Yes / No __________\n# Option 4: SW1=Active, SW2=Static → Channel forms? Yes / No __________\n#\n# TASK 2.4: Best practice mode\n# Recommended LACP mode for both switches: __________\n# Why? __________\n#\n\n# ============================================================================\n# SCENARIO 3: ETHERCHANNEL CONFIGURATION PREREQUISITES\n# ============================================================================\n# Before bundling ports into EtherChannel, all member ports MUST have\n# identical configuration. Your junior technician configured ports\n# Gi0/1-4 for a 4-link bundle.\n#\n# TASK 3.1: Verify prerequisites\n# Required identical settings for bundled ports:\n# 1. Speed: __________ (all same? Gi0/1=1Gbps, Gi0/2=1Gbps, etc.)\n# 2. Duplex: __________ (all same?)\n# 3. VLAN (for L2): __________ (all same?)\n# 4. Trunk config: __________ (native VLAN, allowed VLAN list match?)\n# 5. STP settings: __________ (PortFast, BPDU Guard, Root Guard?)\n#\n# TASK 3.2: Configuration mismatch problem\n# Your technician configured:\n# - Gi0/1: Gi0/2: Gi0/3: 1 Gbps, full-duplex ✓\n# - Gi0/4: 100 Mbps, full-duplex ✗ (Wrong!)\n# \n# Result of bundling these mixed ports:\n# Bundle forms: Yes / No __________\n# If bundle forms, performance issue: Yes / No __________\n# What problem occurs? __________\n#\n# TASK 3.3: Maximum bundle size\n# LACP standard allows: __________ links total\n# (Of which __________ are active, __________ standby)\n#\n# Most Cisco switches allow: __________ active links\n#\n# TASK 3.4: Minimum links requirement\n# Can bundle 2 links? Yes / No __________\n# Can configure minimum bundle size (e.g., 3 of 4)? Yes / No __________\n# If configured minimum=3 and only 2 links up:\n# Bundle functions: Yes / No __________\n#\n\n# ============================================================================\n# SCENARIO 4: CISCO ETHERCHANNEL CONFIGURATION\n# ============================================================================\n# You need to configure a 4-link EtherChannel between SW1 and SW2.\n# Both switches are Cisco (support LACP and PAgP).\n# Links will be: Gi0/1, Gi0/2, Gi0/3, Gi0/4 (all 1 Gbps trunk)\n#\n# TASK 4.1: Configure physical interfaces\n# What command enables multiple interfaces at once?\n# Command: __________ __________\n# Example: __________\n#\n# TASK 4.2: Enable EtherChannel on member ports\n# LACP command to bundle 4 ports as channel group 1:\n# Command: __________ __________ __________\n# \n# Result:\n# - Port-channel 1 created automatically: Yes / No __________\n# - Member ports become: Active/Inactive (__________)\n# - Forwarding state: Up/Down (__________ - if both sides configured)\n#\n# TASK 4.3: Configure port-channel interface\n# Layer 2 trunk configuration commands:\n# 1. Enter port-channel mode: interface __________\n# 2. Enable trunk: __________ __________ __________\n# 3. Set native VLAN: __________ __________ __________ __________\n# 4. Allowed VLANs: __________ __________ __________ __________\n#\n# TASK 4.4: Why configure port-channel interface?\n# Settings applied to port-channel:\n# - Override member port settings: Yes / No __________\n# - Affect all member links: Yes / No __________\n# - Example: Set STP priority on entire bundle vs individual ports?\n# (Configure once on po1, not 4x on individual ports)\n#\n# TASK 4.5: Configuration for 2-link EtherChannel\n# SW1 to SW3 (2-link bundle on Gi0/9-10):\n# \n# interface range gi0/9-10\n# switchport mode trunk\n# channel-group 2 mode active\n# exit\n#\n# interface port-channel 2\n# switchport mode trunk\n# switchport trunk native vlan 999\n# switchport trunk allowed vlan 1,10,20,30\n#\n# Note: Are timers needed? Yes / No __________\n# Note: Is fast LACP recommended: Yes / No __________\n#\n\n# ============================================================================\n# SCENARIO 5: LACP ADVANCED CONFIGURATION\n# ============================================================================\n# You need to fine-tune LACP behavior for faster failure detection\n# and deterministic port selection.\n#\n# TASK 5.1: LACP packet rate\n# Default rate: LACP packets every __________ seconds\n# Fast rate: LACP packets every __________ seconds  \n# Command to enable fast: __________\n#\n# Why use fast rate?\n# A) Faster failure detection\n# B) Increased CPU load\n# C) Better for WAN links\n# D) Avoids loop detection\n# Answer: __________ (choose A/B/C/D)\n#\n# TASK 5.2: System priority\n# What is system priority used for?\n# __________\n#\n# Default: __________ (range: 1-65535)\n# Lower = Higher priority\n#\n# Example: Two switches with 8+ aggregated links\n# - SW1 system priority: 100 (lower = higher priority)\n# - SW2 system priority: 200\n# Which switch's port priorities determine which links active?\n# Answer: __________\n#\n# TASK 5.3: Port priority\n# What is port priority used for?\n# __________\n#\n# Scenario: 8 links between SW1 and SW2\n# LACP can only use 8 active + 8 standby\n# You add 2 more links (total 10)\n# Now have 8 active + 2 standby\n#\n# How does LACP choose which 2 become standby?\n# Lower port priority = Active / Standby __________\n#\n# TASK 5.4: Configuration example\n# Configure Gi0/1-4 for fast LACP failure detection:\n# \n# interface range gi0/1-4\n#   channel-group 1 mode active\n#   lacp rate __________\n#   lacp port-priority __________\n# exit\n#\n\n# ============================================================================\n# SCENARIO 6: LOAD BALANCING FUNDAMENTALS\n# ============================================================================\n# EtherChannel distributes traffic across member links.\n# Your switch has 4 active links in port-channel 1.\n#\n# TASK 6.1: Load balancing concept\n# Is traffic distributed round-robin (1st packet→link1, 2nd→link2)?\n# Yes / No __________\n#\n# Why or why not? __________\n# (Hint: What would happen to packet order?)\n#\n# TASK 6.2: Hash algorithm\n# EtherChannel uses __________ algorithm\n# to determine which link carries each packet\n#\n# Key point: Same source/destination always uses same link\n# Why?\n#\n# TASK 6.3: Load balancing methods\n# Different hash inputs possible:\n# 1. src-mac: Hash on __________ address\n# 2. dst-mac: Hash on __________ address  \n# 3. src-dst-mac: Hash on __________ and __________ address\n# 4. src-ip: Hash on __________ address\n# 5. dst-ip: Hash on __________ address\n# 6. src-dst-ip: Hash on __________ and __________ address\n# 7. src-port: Hash on __________ port number\n# 8. dst-port: Hash on __________ port number\n# 9. src-dst-port: Hash on __________ and __________ port numbers\n#\n# Default on most Cisco switches: __________\n#\n# TASK 6.4: Hash calculation example\n# 4-link bundle (links 0,1,2,3)\n# Formula: Hash(source XOR destination) % 4 = selected link\n#\n# Example 1:\n# Source IP: 10.1.1.100\n# Destination IP: 10.2.2.200\n# Hash = (100 XOR 200) % 4 = __________ % 4 = Link __________\n#\n# Example 2:\n# All traffic from 10.1.1.100 to various servers on 10.2.2.0/24\n# Do all packets from 10.1.1.100 use same link? Yes / No __________\n# (Same source, different destinations)\n#\n# TASK 6.5: Configuration\n# Set load balancing method:\n# Command: __________ __________-__________\n# Example output shows which method configured\n#\n\n# ============================================================================\n# SCENARIO 7: LOAD BALANCING STRATEGY\n# ============================================================================\n# Your network has different data flows needing good distribution.\n# You must choose load balancing method for each connection.\n#\n# TASK 7.1: Server-to-Switch (many clients → one server)\n# Scenario: 100 clients access file server\n# Each client has different source IP\n# All connect to server with same destination IP\n#\n# Which load balancing method gives best distribution?\n# A) src-ip (based on client IP)\n# B) dst-ip (based on server IP)\n# C) src-dst-ip (both)\n# D) src-dst-mac (MAC addresses)\n# Answer: __________ (A/B/C/D)\n#\n# Why? __________\n#\n# TASK 7.2: Switch-to-Switch (many VLAN/subnets)\n# Scenario: Multiple VLANs (10,20,30) sending traffic through core\n# Different subnets, many source/destination combinations\n#\n# Which method for good distribution?\n# A) src-mac\n# B) dst-mac\n# C) src-dst-ip\n# D) src-port\n# Answer: __________ (A/B/C/D)\n#\n# Why? __________\n#\n# TASK 7.3: Single VLAN only\n# Scenario: Data center with one VLAN only (no IP routing between link members)\n# All traffic in same subnet\n#\n# Which method best?\n# A) src-dst-ip (IP addresses same within VLAN)\n# B) src-dst-mac (unique for each device)\n# C) src-port (transport ports vary)\n# Answer: __________ (A/B/C)\n#\n# Why? __________\n#\n# TASK 7.4: Heavy traffic from few sources\n# Problem: 3 servers generate 80% of traffic, only 1 of 4 links used\n# Why? __________\n# How to fix? __________\n#\n\n# ============================================================================\n# SCENARIO 8: ETHERCHANNEL TROUBLESHOOTING\n# ============================================================================\n#\n# TASK 8.1: Bundle won't form\n# You configured EtherChannel between SW1 (Gi0/1-4) and SW2 (Gi0/1-4)\n# Status: Individual ports work, but Po1 stays down\n# \n# List 5 common causes:\n# 1. __________\n# 2. __________\n# 3. __________\n# 4. __________\n# 5. __________\n#\n# TASK 8.2: Verify bundle status command\n# Show summary of all EtherChannels:\n# Command: __________\n#\n# Output interpretation:\n# Group  Port-channel  Protocol    Ports\n# 1      Po1(SU)       LACP        Gi0/1(P)  Gi0/2(P)  Gi0/3(P)  Gi0/4(P)\n#\n# What do these abbreviations mean?\n# (SU): __________ and __________\n# (P): __________\n#\n# TASK 8.3: One link in bundle not bundled\n# Output:\n# Group  Port-channel  Protocol    Ports\n# 1      Po1(SU)       LACP        Gi0/1(P)  Gi0/2(P)  Gi0/3(I)  Gi0/4(P)\n#\n# Gi0/3 shows (I) = Individual\n# What does this mean? __________\n# Likely cause? __________\n#\n# TASK 8.4: Port-channel interface shows SU but no traffic\n# Po1 status: SU (in use)\n# Physical ports: All up and bundled\n# Traffic forwarding: 0 packets per second\n#\n# Likely cause? (Check configuration of po1 interface)\n# __________\n#\n# TASK 8.5: Bundle up on one switch, down on other\n# SW1: Po1(SU) - shows 4 links bundled ✓\n# SW2: Po1 doesn't exist or individual links only\n#\n# Problem: __________\n# Fix: __________\n#\n\n# ============================================================================\n# SCENARIO 9: VERIFICATION AND MONITORING\n# ============================================================================\n#\n# TASK 9.1: Detailed bundle information\n# Show detailed EtherChannel info:\n# Command: __________\n#\n# Output shows:\n# - LACP state (up/down)\n# - System priority\n# - Port priorities  \n# - Member port status\n#\n# TASK 9.2: LACP counters\n# Verify LACP protocol health:\n# Command: __________ etherchannel __________\n#\n# Healthy LACP bundle shows:\n# - PDU transmit: __________ (packets sent)\n# - PDU receive: __________ (packets received)\n# - Marker request: Low count or __________ (ideally none after initial setup)\n#\n# TASK 9.3: Load balancing verification\n# Show current load balancing method:\n# Command: __________ __________\n#\n# Output:\n# EtherChannel Load-Balancing Configuration:\n#     src-dst-ip\n#\n# Verify distribution:\n# Command: __________ interface __________\n# Look for: Traffic counters on each member port (Gi0/1, Gi0/2, etc.)\n#\n# TASK 9.4: Monitoring during failure\n# Simulate link failure (shutdown one port):\n# Steps:\n# 1. __________\n# 2. Verify Po1 stays up (shows SU or SD)\n# 3. __________\n# 4. Check remaining links handle traffic\n#\n# Expected behavior: __________ (should converge in < 1 second)\n#\n\n# ============================================================================\n# SCENARIO 10: MIGRATION AND DESIGN PLANNING\n# ============================================================================\n#\n# TASK 10.1: Current network design\n# Your current setup:\n# - SW1 to SW2: Single Gi0/1 (1 Gbps)\n# - SW1 to SW3: Single Gi0/9 (1 Gbps)  \n# - SW1 to SW4: Single Gi0/17 (1 Gbps)\n# - Total to access layer: 3 Gbps\n#\n# Problem: Single link to each switch = 1 link failure = 1 switch isolated\n#\n# Design EtherChannel solution:\n# - SW1 to SW2: __________ links → __________ Gbps\n# - SW1 to SW3: __________ links → __________ Gbps\n# - SW1 to SW4: __________ links → __________ Gbps\n# - Total bandwidth: __________ Gbps\n# - Redundancy: If any one link fails, service continues: Yes / No __________\n#\n# TASK 10.2: Failure scenarios\n# Scenario A: Link fails in SW1→SW2 4-link bundle\n# - Bundle status: Up (3/4 links active) / Down\n# - SW2 reachable: Yes / No\n# - Performance impact: Reduced to __________ Gbps\n#\n# Scenario B: Entire switch SW2 power failure\n# - SW1→SW2 bundle: Down\n# - SW1→SW3 and SW1→SW4: Up (unaffected)\n# - Isolation proper: Yes / No\n#\n# TASK 10.3: Costs and benefits\n# Additional costs for EtherChannel:\n# 1. __________\n# 2. __________\n# 3. __________\n#\n# Benefits of EtherChannel:\n# 1. __________\n# 2. __________\n# 3. __________\n# 4. __________\n#\n# ROI: Is investment justified? __________\n#\n# TASK 10.4: Implementation plan\n# Migrate current single-link switches to EtherChannel\n# Strategy to minimize downtime:\n#\n# Phase 1: __________\n# Phase 2: __________\n# Phase 3: __________\n# Total downtime estimate: __________ (minutes)\n#\n",
  "solution": "# ============================================================================\n# SCENARIO 1: LINK AGGREGATION FUNDAMENTALS (SOLUTIONS)\n# ============================================================================\n\n# TASK 1.1: Traditional problem explanation\n# Current setup with redundant links:\n# [Switch A] ---Gi0/1--- [Switch B]\n# [Switch A] ---Gi0/2--- [Switch B]   \n# [Switch A] ---Gi0/3--- [Switch B]\n#\n# Both links carry traffic? NO\n# Why? Spanning Tree Protocol (STP) blocks redundant links to prevent loops\n# Only one link forwards, others are in blocking state\n# Result: Adding links for redundancy doesn't increase bandwidth\n#\n# TASK 1.2: Link aggregation solution\n# With EtherChannel:\n# All links active? YES\n# Total bandwidth? 4 Gbps (4x 1 Gbps bundled)\n# Redundancy if one link fails? YES (remaining 3 links continue)\n#\n# STP no longer blocks EtherChannel because:\n# - EtherChannel is treated as single logical link\n# - Loops still prevented (no more parallel paths to block)\n# - All member links forward simultaneously\n#\n# TASK 1.3: EtherChannel benefits\n# 1. Increased bandwidth __________ TRUE\n# 2. Eliminates STP blocking __________ TRUE\n# 3. Requires new switch hardware __________ FALSE (uses existing ports)\n# 4. Automatic failover if link down __________ TRUE  \n# 5. Works with existing infrastructure __________ TRUE\n# 6. Maintains packet order per flow __________ TRUE (hash-based, same flow = same link)\n#\n\n# ============================================================================\n# SCENARIO 2: ETHERCHANNEL PROTOCOL SELECTION (SOLUTIONS)\n# ============================================================================\n\n# TASK 2.1: Protocol standardization\n# Protocol: LACP (Link Aggregation Control Protocol)\n#\n# Why LACP?\n# 1. Vendor-independent (IEEE 802.3ad / 802.1AX standard)\n# 2. Works with Cisco, Juniper, Arista (and all modern vendors)\n# 3. Industry standard (not proprietary)\n# 4. PAgP is legacy (Cisco proprietary, no longer recommended)\n# 5. Future-proof for multi-vendor environments\n#\n# TASK 2.2: Protocol comparison\n#\n# PAgP (Port Aggregation Protocol):\n# - Vendor: Cisco (proprietary)\n# - Standard: No (Cisco proprietary)\n# - Multi-vendor support: No (Cisco only)\n# - Recommended for new deployments: No (legacy)\n#\n# LACP (Link Aggregation Control Protocol):\n# - Standard: IEEE 802.3ad (also 802.1AX)\n# - Vendor independent: Yes\n# - Works with Cisco, Juniper, Arista: Yes\n# - Recommended for new deployments: Yes\n#\n# Static/On Mode:\n# - Protocol negotiation: None\n# - Risk of misconfiguration: High (no negotiation detects mismatches)\n# - Should be used for new designs: No (only if other side can't do LACP)\n#\n# TASK 2.3: LACP mode combinations\n# Option 1: SW1=Active, SW2=Active → Channel forms? YES\n#   Both actively negotiate, LACP PDU exchange succeeds\n#\n# Option 2: SW1=Active, SW2=Passive → Channel forms? YES\n#   Active side initiates, passive responds, negotiation succeeds\n#\n# Option 3: SW1=Passive, SW2=Passive → Channel forms? NO\n#   Both wait for other to initiate, neither sends LACP PDUs\n#   Deadlock = no negotiation = no bundle\n#\n# Option 4: SW1=Active, SW2=Static → Channel forms? NO\n#   Active sends LACP PDUs, Static ignores them\n#   Incompatible negotiation methods\n#\n# TASK 2.4: Best practice\n# Recommended LACP mode: Active (on both sides)\n#\n# Why Active + Active?\n# - Faster failure detection (both sides actively monitoring)\n# - Guaranteed negotiation (not waiting for response)\n# - Recommended in all IEEE documentation\n# - More resilient to configuration mistakes\n#\n# Alternative acceptable: Active + Passive (works fine)\n# Not recommended: Passive + Passive (no negotiation)\n#\n\n# ============================================================================\n# SCENARIO 3: ETHERCHANNEL CONFIGURATION PREREQUISITES (SOLUTIONS)\n# ============================================================================\n\n# TASK 3.1: Verify prerequisites\n# All member ports MUST be identical:\n# 1. Speed: All same (All 1Gbps or all 10Gbps, not mixed)\n# 2. Duplex: All same (full-duplex, not half)\n# 3. VLAN (for L2): All same VLAN or all same trunk config\n# 4. Trunk config: Native VLAN, allowed VLAN list must match\n# 5. STP settings: PortFast, BPDU Guard, Root Guard same\n#\n# Cisco requirement: If ANY setting differs, bundle won't form\n#\n# TASK 3.2: Mismatch problem\n# Configuration:\n# - Gi0/1, Gi0/2, Gi0/3: 1 Gbps, full-duplex\n# - Gi0/4: 100 Mbps, full-duplex (MISMATCH)\n#\n# Result of bundling these mixed ports:\n# Bundle forms: NO (Cisco rejects due to speed mismatch)\n# If bundle somehow forms, performance issue: YES\n# What problem occurs? Bottleneck - all traffic limited to slowest link (100 Mbps)\n# Even though 3 links are 1 Gbps, entire bundle = 100 Mbps max throughput\n#\n# TASK 3.3: Maximum bundle size\n# LACP standard allows: 16 links total\n# (Of which 8 are active, 8 standby)\n#\n# Most Cisco switches allow: 8 active links per EtherChannel\n# (Can have 16 total with standby, but only 8 forwarding)\n#\n# TASK 3.4: Minimum links requirement\n# Can bundle 2 links? YES (minimum is 1, but typically 2+)\n# Can configure minimum bundle size? YES\n# Example: \"lacp min-bundle 3\" requires 3/4 links active to forward\n#\n# If configured minimum=3 and only 2 links up:\n# Bundle functions: NO (disabled until 3rd link active)\n# All traffic drops until minimum threshold met\n#\n\n# ============================================================================\n# SCENARIO 4: CISCO ETHERCHANNEL CONFIGURATION (SOLUTIONS)\n# ============================================================================\n\n# TASK 4.1: Configure physical interfaces\n# Command to enable multiple interfaces: interface range\n# Example: interface range gi0/1-4\n#\n# TASK 4.2: Enable EtherChannel on member ports\n# LACP command: channel-group 1 mode active\n#\n# Result:\n# - Port-channel 1 created automatically: YES (created on first use)\n# - Member ports become: Active (negotiating LACP)\n# - Forwarding state: Up (if both sides configured)\n#\n# TASK 4.3: Configure port-channel interface\n# Layer 2 trunk configuration:\n# 1. Enter port-channel mode: interface port-channel 1\n# 2. Enable trunk: switchport mode trunk\n# 3. Set native VLAN: switchport trunk native vlan 999\n# 4. Allowed VLANs: switchport trunk allowed vlan 1,10,20,30\n#\n# TASK 4.4: Why configure port-channel interface?\n# Settings applied to port-channel:\n# - Override member port settings: YES (po1 config overrides Gi0/1-4)\n# - Affect all member links: YES (all 4 ports use po1 settings)\n# - Example: Configure STP priority once on po1, not 4x on individual ports\n#\n# TASK 4.5: 2-link EtherChannel configuration\n# Is fast LACP recommended: YES (lacp rate fast for faster detection)\n# Are timers needed: NO (defaults are fine for LAN)\n#\n# Enhancement:\n# interface range gi0/9-10\n# switchport mode trunk\n# channel-group 2 mode active\n# lacp rate fast\n# exit\n#\n\n# ============================================================================\n# SCENARIO 5: LACP ADVANCED CONFIGURATION (SOLUTIONS)\n# ============================================================================\n\n# TASK 5.1: LACP packet rate\n# Default rate: LACP packets every 30 seconds\n# Fast rate: LACP packets every 1 second\n# Command to enable fast: lacp rate fast\n#\n# Why use fast rate?\n# Answer: A) Faster failure detection\n# Faster LACP PDUs = faster detection of link down = faster reconvergence\n#\n# TASK 5.2: System priority\n# What is system priority used for?\n# Determines which switch controls active port selection when links exceed 8\n#\n# Default: 32768 (range: 1-65535)\n# Lower = Higher priority\n#\n# Example with 8+ links:\n# - SW1 system priority: 100 (higher priority, controls bundle)\n# - SW2 system priority: 200\n# Which switch's port priorities determine which links active?\n# Answer: SW1 (lower system priority = higher priority to control bundle)\n#\n# TASK 5.3: Port priority\n# What is port priority used for?\n# Determines which specific ports become active vs standby when exceeding 8 active\n#\n# Scenario with 10 links (need to pick 8 active, 2 standby):\n# Lower port priority ports selected as active first\n# Higher port priority ports become standby\n#\n# TASK 5.4: Configuration example\n# interface range gi0/1-4\n#   channel-group 1 mode active\n#   lacp rate fast\n#   lacp port-priority 30000 (lower = more likely to be active)\n# exit\n#\n\n# ============================================================================\n# SCENARIO 6: LOAD BALANCING FUNDAMENTALS (SOLUTIONS)\n# ============================================================================\n\n# TASK 6.1: Round-robin distribution?\n# Is traffic distributed round-robin? NO\n#\n# Why not?\n# Round-robin would reorder packets!\n# Same flow sent out different links = packets arrive out of order\n# TCP would interpret as packet loss and retransmit\n# UDP/VOIP would have gaps or quality issues\n#\n# Solution: Hash algorithm ensures same flow = same link (maintains order)\n#\n# TASK 6.2: Hash algorithm\n# EtherChannel uses: HASH algorithm\n# Key point: Consistent hashing = same source/dest always same link\n#\n# TASK 6.3: Load balancing methods\n# 1. src-mac: Hash on source MAC address\n# 2. dst-mac: Hash on destination MAC address\n# 3. src-dst-mac: Hash on source AND destination MAC\n# 4. src-ip: Hash on source IP address\n# 5. dst-ip: Hash on destination IP address\n# 6. src-dst-ip: Hash on source AND destination IP\n# 7. src-port: Hash on source TCP/UDP port number\n# 8. dst-port: Hash on destination TCP/UDP port number\n# 9. src-dst-port: Hash on source AND destination port numbers\n#\n# Default on most Cisco switches: src-dst-ip (best for data center)\n#\n# TASK 6.4: Hash calculation\n# 4-link bundle (links 0,1,2,3)\n# Formula: Hash(source XOR destination) % 4 = selected link\n#\n# Example 1:\n# Source IP: 10.1.1.100 (binary: 00000100)\n# Destination IP: 10.2.2.200 (binary: 11001000)\n# XOR: 11001100 = 204 decimal\n# Hash = 204 % 4 = Link 0\n#\n# Example 2:\n# All traffic from 10.1.1.100 to various servers on 10.2.2.0/24\n# Do all packets use same link? YES (same source = same hash value)\n# (Different destinations all hash to same link for this source)\n#\n# TASK 6.5: Configuration\n# Command: port-channel load-balance src-dst-ip\n# (Applied globally, affects all EtherChannels)\n#\n\n# ============================================================================\n# SCENARIO 7: LOAD BALANCING STRATEGY (SOLUTIONS)\n# ============================================================================\n\n# TASK 7.1: Many clients → one server\n# Scenario: 100 clients to file server\n# Each client = different source IP\n# All connect to same destination IP (server)\n#\n# Best method: A) src-ip\n# Why? Each client has different source IP\n# src-ip hashes will distribute across all 4 links\n# Result: Good load distribution\n#\n# Why not dst-ip? All clients connect to same destination\n# dst-ip would hash to same link for all clients\n# Result: All clients on one link = no load distribution\n#\n# TASK 7.2: Switch-to-Switch (multiple VLANs/subnets)\n# Scenario: Multiple VLANs sending traffic through core\n# Many source/destination combinations\n#\n# Best method: C) src-dst-ip\n# Why? Different VLANs = different subnets = different IP combinations\n# src-dst-ip considers both = better distribution of diverse traffic\n# Result: All 4 links get utilized\n#\n# TASK 7.3: Single VLAN only\n# Scenario: Data center with one VLAN (no IP routing between link members)\n# All traffic in same subnet\n#\n# Best method: B) src-dst-mac\n# Why? IP addresses may be similar within subnet\n# src-ip hash of similar IPs may map to same link\n# MAC addresses vary regardless of subnet\n# src-dst-mac gives better distribution\n#\n# Why not src-dst-ip? IPs in same subnet cluster = similar hashes\n# Result: Uneven distribution\n#\n# TASK 7.4: Heavy traffic from few sources\n# Problem: 3 servers = 80% of traffic, only 1 of 4 links used\n# Why? Those 3 servers' IP addresses likely hash to same link\n# How to fix? Try src-dst-port (includes TCP/UDP ports)\n# Different port numbers may hash to different links\n# Or use src-dst-mac if not using IP routing\n#\n\n# ============================================================================\n# SCENARIO 8: ETHERCHANNEL TROUBLESHOOTING (SOLUTIONS)\n# ============================================================================\n\n# TASK 8.1: Bundle won't form - 5 common causes\n# 1. LACP mode mismatch (e.g., Active vs Passive on opposite side)\n# 2. Speed mismatch (one link 1Gbps, another 100Mbps)\n# 3. Duplex mismatch (one full-duplex, one half-duplex)\n# 4. VLAN/Trunk config different (different allowed VLAN lists)\n# 5. Spanning Tree or other setting mismatch (PortFast, BPDU Guard)\n#\n# TASK 8.2: Verify bundle status\n# Command: show etherchannel summary\n#\n# Abbreviations:\n# (SU): Layer 2 (Switched) + in Use (at least one member up)\n# (P): Port bundled (participating in EtherChannel)\n#\n# Other flags:\n# (D): Down (all members down)\n# (SD): Switched, Down\n# (R): Layer 3 (Routed)\n# (I): Individual (not bundled, failed to bundle)\n#\n# TASK 8.3: One link shows (I) Individual\n# What does (I) mean? This port failed to bundle\n# Likely cause? Configuration mismatch on that specific port\n# (E.g., speed different, VLAN different, duplex different)\n#\n# TASK 8.4: Po1 up but no traffic\n# Likely cause? Po1 interface itself down or not configured\n# Check: Is Po1 set to \"no shutdown\"?\n# Is Po1 assigned to correct VLAN?\n# Is port-channel interface actually configured (not just member ports)?\n#\n# TASK 8.5: Bundle up on SW1, down on SW2\n# Problem: SW2 never configured for EtherChannel\n# Fix: Configure matching EtherChannel on SW2 (channel-group 1 mode active on same ports)\n#\n\n# ============================================================================\n# SCENARIO 9: VERIFICATION AND MONITORING (SOLUTIONS)\n# ============================================================================\n\n# TASK 9.1: Detailed bundle information\n# Command: show etherchannel <number> detail\n#\n# Example: show etherchannel 1 detail\n# Shows detailed LACP state, priorities, timers\n#\n# TASK 9.2: LACP counters\n# Command: show etherchannel port-channel\n#\n# Healthy LACP bundle shows:\n# - PDU transmit: Hundreds or thousands (sent out regularly)\n# - PDU receive: Similar to transmit (receiving responses)\n# - Marker request: None or very low (only during negotiation)\n# - High marker requests = LACP negotiation problems\n#\n# TASK 9.3: Load balancing verification\n# Command: show port-channel load-balance\n#\n# Verify distribution:\n# Command: show interface port-channel 1\n# Look for: Traffic counters on each member port (Gi0/1, Gi0/2, etc.)\n# Command: show interface gi0/1 | include Input|Output\n#\n# Good distribution: Similar byte counts on each member\n# Bad distribution: One link much higher = hash algorithm or traffic pattern issue\n#\n# TASK 9.4: Monitoring during failure\n# Steps:\n# 1. Show etherchannel summary (baseline - all 4 links up)\n# 2. Shutdown one port (conf t → int gi0/1 → shutdown)\n# 3. Show etherchannel summary (should show 3 active, 1 down)\n# 4. Verify Po1 still shows SU (still in use)\n#\n# Expected behavior: Converges in < 50ms (nearly instantaneous)\n# Traffic redirects to remaining 3 links automatically\n#\n\n# ============================================================================\n# SCENARIO 10: MIGRATION AND DESIGN PLANNING (SOLUTIONS)\n# ============================================================================\n\n# TASK 10.1: Design EtherChannel solution\n# Current: 1 link to each switch = 3 Gbps total, SINGLE POINT OF FAILURE\n#\n# New design:\n# - SW1 to SW2: 4 links → 4 Gbps (redundancy: survive 3 link failures)\n# - SW1 to SW3: 2 links → 2 Gbps (redundancy: survive 1 link failure)  \n# - SW1 to SW4: 3 links → 3 Gbps (redundancy: survive 2 link failures)\n# - Total bandwidth: 9 Gbps (up from 3 Gbps)\n# - Redundancy: If any one link fails, service continues: YES\n#\n# TASK 10.2: Failure scenarios\n# Scenario A: One link fails in SW1→SW2 4-link bundle\n# - Bundle status: Up (3/4 links active)\n# - SW2 reachable: YES (3 links still connected)\n# - Performance: Reduced to 3 Gbps (still usable)\n#\n# Scenario B: Entire switch SW2 power failure\n# - SW1→SW2 bundle: Down (all 4 links down)\n# - SW1→SW3 and SW1→SW4: Up (unaffected)\n# - Isolation proper: YES (failure isolated to SW2 connection)\n#\n# TASK 10.3: Costs and benefits\n#\n# Additional costs:\n# 1. Switch port costs (need 4+2+3=9 total ports vs 3 before)\n# 2. Cable and connectivity hardware\n# 3. Configuration and testing time\n#\n# Benefits:\n# 1. 3x bandwidth increase (3 Gbps → 9 Gbps)\n# 2. Automatic failover (transparent to applications)\n# 3. Eliminates single point of failure\n# 4. Future scalability with more links\n#\n# ROI: YES (bandwidth increase + redundancy justifies costs)\n#\n# TASK 10.4: Implementation plan - zero downtime migration\n#\n# Phase 1: Configure EtherChannel on SW1 side\n# - Create channel-group 1 on Gi0/1-4\n# - Configure port-channel 1\n# - SW1 to SW2 still single link (no change yet)\n# - Downtime: 0 minutes\n#\n# Phase 2: Configure matching EtherChannel on SW2 side  \n# - Create channel-group 1 on Gi0/1-4\n# - Configure port-channel 1\n# - EtherChannel negotiates, now 4 links active\n# - Downtime: < 1 minute (negotiation + convergence)\n#\n# Phase 3: Add additional links\n# - Connect cables to remaining ports (Gi0/5-7)\n# - Reconfigure to 7-link bundle\n# - No downtime (new links join existing bundle)\n#\n# Total downtime: < 1 minute (just phase 2 convergence)\n# Risk mitigation: Rollback in < 2 minutes if needed\n#\n",
  "hints": [
    "Link Aggregation combines multiple physical links into ONE logical link",
    "EtherChannel prevents STP blocking by appearing as single logical link (no redundant paths)",
    "LACP (IEEE 802.3ad) is standard - use in multi-vendor environments, PAgP is Cisco proprietary",
    "All bundle member ports MUST have identical speed, duplex, VLAN, trunk config",
    "Cisco default: 8 active links per EtherChannel (LACP allows 16 total with 8 standby)",
    "Load balancing uses HASH algorithm - same flow always uses same link (maintains packet order)",
    "Default hash method on Cisco: src-dst-ip (good for data center environments)",
    "Active+Active LACP mode recommended, Passive+Passive won't work (both wait for negotiation)",
    "Show etherchannel summary shows (P)=bundled, (I)=individual (failed to bundle), (SU)=switched/up",
    "Fast LACP (rate fast) sends PDUs every 1 sec vs 30 sec - faster failure detection",
    "Hash algorithm ensures same source/destination always uses same link - prevents packet reordering",
    "Load balancing strategy: Many clients→server=src-ip, Multi-VLAN=src-dst-ip, Single VLAN=src-dst-mac"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Understands link aggregation purpose: increased bandwidth, redundancy, STP bypass",
      "validation": "assert ('bandwidth' in code.lower() or 'redundancy' in code.lower()) and ('stp' in code.lower() or 'spanning' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Knows EtherChannel protocols: PAgP (Cisco proprietary/legacy), LACP (standard), Static (no negotiation)",
      "validation": "assert ('lacp' in code.lower() or 'pagp' in code.lower()) and ('standard' in code.lower() or 'protocol' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Understands LACP modes: Active (recommended), Passive, Static and mode compatibility",
      "validation": "assert ('active' in code.lower() or 'passive' in code.lower() or 'mode' in code.lower()) and code.lower().count(('lacp', 'mode')) >= 2",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Knows prerequisite requirements: all ports must have identical speed, duplex, VLAN, trunk config",
      "validation": "assert ('speed' in code.lower() or 'duplex' in code.lower() or 'vlan' in code.lower() or 'config' in code.lower()) and ('identical' in code.lower() or 'match' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc5",
      "description": "Understands load balancing: hash algorithm, same flow same link, not round-robin",
      "validation": "assert ('hash' in code.lower() or 'load' in code.lower()) and ('link' in code.lower() or 'flow' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc6",
      "description": "Knows load balancing methods: src-mac, dst-mac, src-ip, dst-ip, src-port, dst-port and when to use each",
      "validation": "assert code.lower().count(('src', 'dst', 'ip', 'mac', 'port')) >= 5 or 'load-balance' in code.lower()",
      "isHidden": false
    },
    {
      "id": "tc7",
      "description": "Understands verification: show etherchannel summary, show etherchannel detail, port flags (P/I/S/D)",
      "validation": "assert ('show etherchannel' in code.lower() or 'etherchannel' in code.lower()) and ('summary' in code.lower() or '(p)' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc8",
      "description": "Knows troubleshooting: speed mismatch, mode mismatch, VLAN mismatch prevent bundle formation",
      "validation": "assert ('troubleshoot' in code.lower() or 'mismatch' in code.lower() or 'bundle' in code.lower()) and code.count(('speed', 'duplex', 'vlan', 'mode')) >= 2",
      "isHidden": false
    },
    {
      "id": "tc9",
      "description": "Understands maximum bundle size: 8 active (Cisco), 16 total (LACP with standby)",
      "validation": "assert ('8' in code or '16' in code) and ('active' in code.lower() or 'standby' in code.lower())",
      "isHidden": false
    },
    {
      "id": "tc10",
      "description": "Total file size meets 10,000+ character minimum",
      "validation": "assert len(code) >= 10000",
      "isHidden": true
    },
    {
      "id": "tc11",
      "description": "Covers major lesson 020 concepts: EtherChannel protocols, LACP, configuration, load balancing, troubleshooting",
      "validation": "assert code.count('task') >= 8 and ('etherchannel' in code.lower() or 'lacp' in code.lower()) and code.count(('scenario', 'config', 'troubleshoot')) >= 3",
      "isHidden": true
    }
  ]
}
