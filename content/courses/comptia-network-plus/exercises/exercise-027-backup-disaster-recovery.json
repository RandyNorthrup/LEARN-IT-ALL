{
  "id": "exercise-027-backup-disaster-recovery",
  "lessonId": "lesson-027-backup-disaster-recovery",
  "title": "Backup Strategy and DR Planning",
  "description": "Your company just suffered a ransomware attack that encrypted the primary file server. Fortunately, backups were off-site and intact. However, recovery took 48 hours, and management wants to improve the recovery process. You need to design a comprehensive backup and disaster recovery strategy that meets aggressive RPO (Recovery Point Objective) and RTO (Recovery Time Objective) requirements while staying within budget constraints.",
  "difficulty": "medium",
  "points": 75,
  "language": "text",
  "scenario": {
    "company": "Financial Services Group",
    "situation": "Recovering from ransomware attack, need to improve backup and DR strategy",
    "business_requirements": {
      "rpo": "1 hour (maximum data loss acceptable)",
      "rto": "4 hours (maximum downtime acceptable)",
      "compliance": "SOC 2 Type II requires 90-day backup retention",
      "budget": "$50,000 annually for backup infrastructure"
    },
    "infrastructure": {
      "critical_systems": [
        "Database servers (5 TB)",
        "File servers (10 TB)",
        "Email server (2 TB)"
      ],
      "network_equipment": "Core routers and switches (configs < 1 GB)",
      "locations": "Primary datacenter + remote office 50 miles away",
      "internet_bandwidth": "1 Gbps at primary, 100 Mbps at remote"
    }
  },
  "starterCode": "# Backup and Disaster Recovery Strategy\n# Financial Services Group\n\n## 1. Current State Assessment\n**Recent Incident:**\n- Ransomware attack encrypted primary file server\n- Recovery took 48 hours (unacceptable for business operations)\n- Data loss: 24 hours of work (last backup was previous night)\n\n**Business Impact:**\n- Revenue loss: $_____ (48 hours downtime @ $5,000/hour)\n- Compliance violation risk: ___\n- Customer trust impact: ___\n\n## 2. Recovery Objectives\n**RPO (Recovery Point Objective):** ___\n- Definition: ___\n- Current RPO: ___ hours\n- Target RPO: 1 hour\n- Gap: ___ hours\n\n**RTO (Recovery Time Objective):** ___\n- Definition: ___\n- Current RTO: 48 hours\n- Target RTO: 4 hours\n- Gap: ___ hours\n\n**MTBF (Mean Time Between Failures):** ___\n**MTTR (Mean Time To Repair):** ___\n\n## 3. Backup Strategy Design\n\n### 3.1 Backup Types Selection\n| Backup Type | Frequency | Target Systems | Storage Required | Backup Window |\n|-------------|-----------|----------------|------------------|---------------|\n| Full | ___ | All systems | ___ TB | ___ hours |\n| Incremental | ___ | All systems | ___ GB/day | ___ minutes |\n| Differential | ___ | Critical only | ___ GB/day | ___ minutes |\n| Snapshot | ___ | VMs | Minimal | Seconds |\n\n**Recommended Schedule:**\n- Full backups: ___\n- Incremental backups: ___\n- Reasoning: ___\n\n### 3.2 3-2-1 Backup Rule Implementation\n**Rule:** ___ copies, ___ different media types, ___ off-site\n\n**Implementation:**\n1. Copy 1 (Primary): ___\n   - Location: ___\n   - Media type: ___\n   - Purpose: ___\n\n2. Copy 2 (Secondary): ___\n   - Location: ___\n   - Media type: ___\n   - Purpose: ___\n\n3. Copy 3 (Off-site): ___\n   - Location: ___\n   - Media type: ___\n   - Purpose: ___\n\n### 3.3 Grandfather-Father-Son (GFS) Rotation\n**Weekly Backups (Son):** ___\n- Retention: ___ weeks\n- Storage: ___ TB\n\n**Monthly Backups (Father):** ___\n- Retention: ___ months\n- Storage: ___ TB\n\n**Yearly Backups (Grandfather):** ___\n- Retention: ___ years\n- Storage: ___ TB\n\n**Total Storage Required:** ___ TB\n\n## 4. RPO/RTO Calculations\n\n### 4.1 Achieving 1-Hour RPO\n**Solution:**\n- Backup frequency: ___\n- Technology: ___ (continuous replication, snapshots, etc.)\n- Implementation: ___\n\n**Calculation:**\nIf backup runs every ___ minutes:\n- Maximum data loss = ___ hour ✓\n- Meets RPO requirement: Yes/No\n\n### 4.2 Achieving 4-Hour RTO\n**Recovery Steps:**\n1. ___ (time: ___ minutes)\n2. ___ (time: ___ minutes)\n3. ___ (time: ___ minutes)\n4. ___ (time: ___ minutes)\n5. ___ (time: ___ minutes)\n\n**Total Recovery Time:** ___ hours\n**Meets RTO requirement:** Yes/No\n\n**Optimization for faster recovery:**\n- ___\n- ___\n- ___\n\n## 5. Disaster Recovery Sites\n\n### 5.1 DR Site Selection\n**Chosen DR Site Type:** ___ (Cold/Warm/Hot/Cloud)\n\n| Site Type | Cost | RTO | RPO | Suitability |\n|-----------|------|-----|-----|-------------|\n| Cold site | $ | Days | Hours | ___ |\n| Warm site | $$ | Hours | Minutes | ___ |\n| Hot site | $$$ | Minutes | Seconds | ___ |\n| Cloud DR | $$ | Hours | Minutes | ___ |\n\n**Justification:**\n___\n___\n___\n\n### 5.2 DR Site Configuration\n**Location:** ___\n**Infrastructure:**\n- Servers: ___\n- Network: ___\n- Storage: ___\n- Internet: ___\n\n**Failover Process:**\n1. ___\n2. ___\n3. ___\n4. ___\n\n**Estimated Failover Time:** ___ hours\n\n## 6. Network Equipment Backup\n\n**Configuration Backup Strategy:**\n| Device Type | Backup Method | Frequency | Retention |\n|-------------|---------------|-----------|------------|\n| Core routers | ___ | ___ | ___ |\n| Core switches | ___ | ___ | ___ |\n| Firewalls | ___ | ___ | ___ |\n\n**Recommended Tools:**\n- ___\n- ___\n- ___\n\n## 7. Testing and Validation\n\n**Backup Restore Testing Schedule:**\n- Full restore test: ___ (frequency)\n- Partial restore test: ___ (frequency)\n- DR failover test: ___ (frequency)\n\n**Test Results Documentation:**\n- Actual RTO achieved: ___ hours\n- Actual RPO achieved: ___ minutes\n- Issues identified: ___\n- Corrective actions: ___\n\n## 8. Cost Analysis\n\n**Annual Budget: $50,000**\n\n| Component | Cost | Justification |\n|-----------|------|---------------|\n| Backup software licenses | $_____ | ___ |\n| Primary backup storage (NAS) | $_____ | ___ |\n| Off-site storage (cloud) | $_____ | ___ |\n| DR site (warm site subscription) | $_____ | ___ |\n| Network bandwidth (replication) | $_____ | ___ |\n| Testing and maintenance | $_____ | ___ |\n| **Total** | **$_____** | Within budget: Yes/No |\n\n## 9. Compliance Requirements\n\n**SOC 2 Type II Requirements:**\n- [ ] 90-day backup retention: ___\n- [ ] Encryption at rest: ___\n- [ ] Encryption in transit: ___\n- [ ] Access logging: ___\n- [ ] Regular restore testing: ___\n- [ ] Annual DR drill: ___",
  "solution": "# Backup and Disaster Recovery Strategy\n# Financial Services Group\n\n## 1. Current State Assessment\n**Recent Incident:**\n- Ransomware attack encrypted primary file server\n- Recovery took 48 hours (unacceptable for business operations)\n- Data loss: 24 hours of work (last backup was previous night)\n\n**Business Impact:**\n- Revenue loss: $240,000 (48 hours downtime @ $5,000/hour)\n- Compliance violation risk: SOC 2 audit failure potential\n- Customer trust impact: Reputational damage, potential client loss\n\n## 2. Recovery Objectives\n**RPO (Recovery Point Objective):** Maximum acceptable data loss\n- Definition: Maximum amount of data (measured in time) that can be lost\n- Current RPO: 24 hours\n- Target RPO: 1 hour\n- Gap: 23 hours (needs hourly or continuous backups)\n\n**RTO (Recovery Time Objective):** Maximum acceptable downtime\n- Definition: Maximum time to restore service after failure\n- Current RTO: 48 hours\n- Target RTO: 4 hours\n- Gap: 44 hours (needs faster restore process and warm DR site)\n\n**MTBF (Mean Time Between Failures):** 8,760 hours (1 year - target availability 99.9%)\n**MTTR (Mean Time To Repair):** 4 hours (equals RTO target)\n\n## 3. Backup Strategy Design\n\n### 3.1 Backup Types Selection\n| Backup Type | Frequency | Target Systems | Storage Required | Backup Window |\n|-------------|-----------|----------------|------------------|---------------|\n| Full | Weekly (Sunday 1 AM) | All systems | 17 TB | 6 hours |\n| Incremental | Hourly | All systems | 50 GB/hour | 10 minutes |\n| Differential | Not used | - | - | - |\n| Snapshot | Every 4 hours | VMs | Minimal (dedupe) | Seconds |\n\n**Recommended Schedule:**\n- Full backups: Sunday 1:00 AM (weekly)\n- Incremental backups: Every hour, 24/7\n- Reasoning: Hourly incrementals achieve 1-hour RPO, weekly full reduces restore complexity\n\n### 3.2 3-2-1 Backup Rule Implementation\n**Rule:** 3 copies, 2 different media types, 1 off-site\n\n**Implementation:**\n1. Copy 1 (Primary): Production data on primary storage\n   - Location: Primary datacenter SAN\n   - Media type: Disk (SSD/HDD)\n   - Purpose: Live production data\n\n2. Copy 2 (Secondary): Local backup\n   - Location: Primary datacenter backup NAS\n   - Media type: Disk (high-capacity HDD)\n   - Purpose: Fast local restore (meets 4-hour RTO)\n\n3. Copy 3 (Off-site): Cloud backup\n   - Location: AWS S3 Glacier or Azure Blob Storage\n   - Media type: Cloud object storage\n   - Purpose: Protection against site-wide disaster, compliance retention\n\n### 3.3 Grandfather-Father-Son (GFS) Rotation\n**Weekly Backups (Son):** 4 weekly full backups retained\n- Retention: 4 weeks\n- Storage: 68 TB (17 TB × 4)\n\n**Monthly Backups (Father):** 12 monthly full backups retained\n- Retention: 12 months\n- Storage: 204 TB (17 TB × 12)\n\n**Yearly Backups (Grandfather):** 7 yearly full backups retained\n- Retention: 7 years\n- Storage: 119 TB (17 TB × 7)\n\n**Total Storage Required:** 391 TB (local) + 391 TB (cloud)\n\n## 4. RPO/RTO Calculations\n\n### 4.1 Achieving 1-Hour RPO\n**Solution:**\n- Backup frequency: Hourly incremental backups\n- Technology: Veeam Backup & Replication with CDP (Continuous Data Protection) for critical VMs\n- Implementation: Incremental forever with synthetic fulls, change block tracking\n\n**Calculation:**\nIf backup runs every 60 minutes:\n- Maximum data loss = 1 hour ✓\n- Meets RPO requirement: Yes\n\n### 4.2 Achieving 4-Hour RTO\n**Recovery Steps:**\n1. Identify failure and initiate recovery (time: 15 minutes)\n2. Locate most recent backup (time: 5 minutes)\n3. Restore from local NAS (17 TB @ 1 GB/s) (time: 140 minutes)\n4. Verify data integrity and boot systems (time: 30 minutes)\n5. User acceptance testing (time: 30 minutes)\n\n**Total Recovery Time:** 3.67 hours (220 minutes)\n**Meets RTO requirement:** Yes (under 4 hours)\n\n**Optimization for faster recovery:**\n- Use instant VM recovery (boot directly from backup storage)\n- Implement warm DR site with pre-staged environment\n- Use storage replication for critical databases (near-zero RTO)\n\n## 5. Disaster Recovery Sites\n\n### 5.1 DR Site Selection\n**Chosen DR Site Type:** Warm site\n\n| Site Type | Cost | RTO | RPO | Suitability |\n|-----------|------|-----|-----|-------------|\n| Cold site | $5K/yr | 3-7 days | Hours | Too slow |\n| Warm site | $25K/yr | 2-8 hours | Minutes | ✓ Best fit |\n| Hot site | $100K/yr | Minutes | Seconds | Too expensive |\n| Cloud DR | $20K/yr | 4-12 hours | Minutes | Good alternative |\n\n**Justification:**\n- Warm site meets 4-hour RTO requirement\n- Within $50K annual budget\n- Pre-configured hardware reduces failover time\n- More cost-effective than hot site for our RTO needs\n\n### 5.2 DR Site Configuration\n**Location:** Remote office 50 miles from primary datacenter (different fault zone)\n**Infrastructure:**\n- Servers: 3 physical hosts (80% capacity of production)\n- Network: 100 Mbps internet, VPN to primary site\n- Storage: 20 TB NAS (incremental backups replicated hourly)\n- Internet: Sufficient for email and critical web services\n\n**Failover Process:**\n1. Declare disaster (executive authorization)\n2. Stop replication to freeze consistent state\n3. Power on VMs from replicated storage at warm site\n4. Update DNS to point to DR site public IPs\n5. Notify users of DR activation\n\n**Estimated Failover Time:** 3 hours\n\n## 6. Network Equipment Backup\n\n**Configuration Backup Strategy:**\n| Device Type | Backup Method | Frequency | Retention |\n|-------------|---------------|-----------|------------|\n| Core routers | Oxidized/RANCID | Daily | 90 days |\n| Core switches | Oxidized/RANCID | Daily | 90 days |\n| Firewalls | Automated SFTP export | Daily | 180 days |\n\n**Recommended Tools:**\n- Oxidized (open-source, automated config backups)\n- Git (version control for config changes)\n- TFTP/SFTP server for automated transfers\n\n## 7. Testing and Validation\n\n**Backup Restore Testing Schedule:**\n- Full restore test: Quarterly (every 3 months)\n- Partial restore test: Monthly (verify backup integrity)\n- DR failover test: Semi-annually (twice per year)\n\n**Test Results Documentation:**\n- Actual RTO achieved: 3.5 hours (better than 4-hour target)\n- Actual RPO achieved: 55 minutes (better than 1-hour target)\n- Issues identified: DNS propagation slow (15 minutes)\n- Corrective actions: Pre-lower DNS TTL before DR test\n\n## 8. Cost Analysis\n\n**Annual Budget: $50,000**\n\n| Component | Cost | Justification |\n|-----------|------|---------------|\n| Backup software licenses (Veeam) | $8,000 | Enterprise Plus for 50 VMs |\n| Primary backup storage (50 TB NAS) | $12,000 | QNAP or Synology enterprise NAS |\n| Off-site storage (cloud 400 TB) | $4,800 | AWS S3 Glacier @ $1/TB/month |\n| DR site (warm site subscription) | $18,000 | Colo facility with power/cooling |\n| Network bandwidth (replication) | $2,400 | 100 Mbps dedicated circuit |\n| Testing and maintenance | $4,800 | Quarterly DR tests + engineer time |\n| **Total** | **$50,000** | Within budget: Yes |\n\n## 9. Compliance Requirements\n\n**SOC 2 Type II Requirements:**\n- [X] 90-day backup retention: GFS rotation retains 7 years\n- [X] Encryption at rest: AES-256 on NAS and cloud storage\n- [X] Encryption in transit: TLS 1.3 for replication\n- [X] Access logging: All backup access logged to SIEM\n- [X] Regular restore testing: Quarterly full restore tests documented\n- [X] Annual DR drill: Semi-annual DR failover tests (exceeds requirement)",
  "hints": [
    "RPO = maximum acceptable data loss (time-based, e.g., 1 hour)",
    "RTO = maximum acceptable downtime (time to restore, e.g., 4 hours)",
    "3-2-1 rule: 3 copies, 2 different media types, 1 off-site copy",
    "Hourly incremental backups achieve 1-hour RPO (worst case: lose data since last backup)",
    "Warm DR site balances cost and recovery time (typically 2-8 hours RTO)",
    "Hot site is expensive ($100K+/year) but provides fastest recovery (minutes)",
    "Cold site is cheap but slow (days to recover)",
    "GFS rotation: Daily (son), Weekly (father), Monthly (grandfather)",
    "Calculate total storage: Data size × retention periods for each tier",
    "SOC 2 requires 90-day retention minimum, encryption, and regular testing"
  ],
  "testCases": [
    {
      "id": "tc1-rpo",
      "description": "RPO definition",
      "input": "RPO concept",
      "expected": "RPO is maximum acceptable data loss measured in time",
      "assert": "assert 'data loss' in solution.lower() or 'RPO' in solution"
    },
    {
      "id": "tc2-rto",
      "description": "RTO definition",
      "input": "RTO concept",
      "expected": "RTO is maximum acceptable downtime to restore service",
      "assert": "assert 'downtime' in solution.lower() or 'restore' in solution.lower()"
    },
    {
      "id": "tc3-3-2-1",
      "description": "3-2-1 backup rule",
      "input": "Backup rule",
      "expected": "3 copies, 2 media types, 1 off-site",
      "assert": "assert '3' in solution and '2' in solution and '1' in solution and 'off-site' in solution.lower()"
    },
    {
      "id": "tc4-hourly",
      "description": "Hourly backups for 1-hour RPO",
      "input": "Backup frequency",
      "expected": "Hourly incremental backups to achieve 1-hour RPO",
      "assert": "assert 'hourly' in solution.lower() or 'Hourly' in solution"
    },
    {
      "id": "tc5-warm-site",
      "description": "DR site selection",
      "input": "DR type",
      "expected": "Warm site chosen (balances cost and RTO)",
      "assert": "assert 'warm' in solution.lower() or 'Warm' in solution"
    },
    {
      "id": "tc6-gfs",
      "description": "GFS rotation",
      "input": "Retention strategy",
      "expected": "Grandfather-Father-Son rotation with weekly, monthly, yearly retention",
      "assert": "assert 'Grandfather' in solution or 'GFS' in solution"
    },
    {
      "id": "tc7-budget",
      "description": "Budget constraint",
      "input": "Cost analysis",
      "expected": "Total cost within $50,000 annual budget",
      "assert": "assert '50,000' in solution or '50K' in solution"
    },
    {
      "id": "tc8-rto-calc",
      "description": "RTO calculation",
      "input": "Recovery time",
      "expected": "Recovery steps documented with time estimates totaling <4 hours",
      "assert": "assert 'hours' in solution.lower() and 'minutes' in solution.lower()"
    },
    {
      "id": "tc9-retention",
      "description": "Compliance retention",
      "input": "SOC 2 requirement",
      "expected": "SOC 2 requires 90-day minimum retention",
      "assert": "assert '90' in solution and 'days' in solution.lower()"
    },
    {
      "id": "tc10-testing",
      "description": "Testing schedule",
      "input": "Validation process",
      "expected": "Regular backup restore testing (quarterly, monthly, or more frequent)",
      "assert": "assert 'quarterly' in solution.lower() or 'monthly' in solution.lower()"
    }
  ]
}
