{
  "id": "exercise-073-closure-patterns",
  "lessonId": "lesson-059-closure-patterns",
  "title": "Practical Closure Design Patterns",
  "description": "Master real-world closure patterns. Build function factories, stateful functions, and configuration builders.\n\nYour program should:\n1. Create function factories that customize behavior\n2. Build stateful functions with preserved state\n3. Implement configuration builders\n4. Use closures for data privacy\n5. Create specialized functions from general ones\n6. Apply closures to practical problems\n\nImplement these functions:\n- `make_multiplier(factor)`: Simple function factory\n- `create_validator(min_val, max_val)`: Validation factory\n- `make_formatter(prefix, suffix)`: String formatter factory\n- `create_rate_limiter(max_calls, window)`: Rate limiter\n- `build_calculator(operator)`: Calculator factory\n- `make_cache()`: Simple caching closure\n\nExample:\n```python\ntriple = make_multiplier(3)\ntriple(5)  # 15\n```",
  "difficulty": "intermediate",
  "points": 20,
  "language": "python",
  "starterCode": "def make_multiplier(factor):\n    \"\"\"Create function that multiplies by factor.\n    \n    Args:\n        factor: Multiplication factor.\n    \n    Returns:\n        Function that multiplies by factor.\n    \"\"\"\n    # TODO: Return closure\n    # def multiply(x):\n    #     return x * factor\n    # return multiply\n    \n    pass\n\ndef create_validator(min_val, max_val):\n    \"\"\"Create range validator function.\n    \n    Args:\n        min_val: Minimum valid value.\n        max_val: Maximum valid value.\n    \n    Returns:\n        Function that validates value in range.\n    \"\"\"\n    # TODO: Return validation closure\n    # def validate(value):\n    #     return min_val <= value <= max_val\n    # return validate\n    \n    pass\n\ndef make_formatter(prefix, suffix):\n    \"\"\"Create string formatter with prefix/suffix.\n    \n    Args:\n        prefix: String to prepend.\n        suffix: String to append.\n    \n    Returns:\n        Function that formats strings.\n    \"\"\"\n    # TODO: Return formatter closure\n    # def format_string(text):\n    #     return f\"{prefix}{text}{suffix}\"\n    # return format_string\n    \n    pass\n\ndef create_rate_limiter(max_calls):\n    \"\"\"Create rate limiter (simplified).\n    \n    Args:\n        max_calls: Maximum allowed calls.\n    \n    Returns:\n        Function that checks if call allowed.\n    \"\"\"\n    # TODO: Track call count with nonlocal\n    # call_count = 0\n    # \n    # def can_call():\n    #     nonlocal call_count\n    #     if call_count < max_calls:\n    #         call_count += 1\n    #         return True\n    #     return False\n    # \n    # return can_call\n    \n    pass\n\ndef build_calculator(operator):\n    \"\"\"Create calculator for specific operation.\n    \n    Args:\n        operator: Operation string ('add', 'multiply', 'power').\n    \n    Returns:\n        Function that performs the operation.\n    \"\"\"\n    # TODO: Return operation-specific function\n    # if operator == 'add':\n    #     return lambda x, y: x + y\n    # elif operator == 'multiply':\n    #     return lambda x, y: x * y\n    # elif operator == 'power':\n    #     return lambda x, y: x ** y\n    # else:\n    #     return lambda x, y: 0\n    \n    pass\n\ndef make_cache():\n    \"\"\"Create simple memoization cache.\n    \n    Returns:\n        Dict with 'get' and 'set' functions.\n    \"\"\"\n    # TODO: Cache using closure\n    # cache = {}\n    # \n    # def get(key):\n    #     return cache.get(key)\n    # \n    # def set_value(key, value):\n    #     cache[key] = value\n    # \n    # def has(key):\n    #     return key in cache\n    # \n    # return {'get': get, 'set': set_value, 'has': has}\n    \n    pass\n\n# Test functions\nprint(\"Closure Design Patterns:\")\nprint(\"=\"*60)\n\nprint(\"\\nPattern 1: Function Factory (Multipliers):\")\nprint(\"-\"*60)\ndouble = make_multiplier(2)\ntriple = make_multiplier(3)\ntimes_ten = make_multiplier(10)\n\nprint(\"double = make_multiplier(2)\")\nprint(f\"  double(5): {double(5)}\")\nprint(f\"  double(10): {double(10)}\")\n\nprint(\"\\ntriple = make_multiplier(3)\")\nprint(f\"  triple(5): {triple(5)}\")\nprint(f\"  triple(10): {triple(10)}\")\n\nprint(\"\\nEach closure 'remembers' its factor\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Pattern 2: Validation Factory:\")\nprint(\"=\"*60)\nage_validator = create_validator(0, 150)\npercentage_validator = create_validator(0, 100)\n\nprint(\"age_validator = create_validator(0, 150)\")\nprint(f\"  age_validator(25): {age_validator(25)}\")\nprint(f\"  age_validator(200): {age_validator(200)}\")\n\nprint(\"\\npercentage_validator = create_validator(0, 100)\")\nprint(f\"  percentage_validator(50): {percentage_validator(50)}\")\nprint(f\"  percentage_validator(150): {percentage_validator(150)}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Pattern 3: Formatter Factory:\")\nprint(\"=\"*60)\nhtml_bold = make_formatter(\"<b>\", \"</b>\")\nmarkdown_bold = make_formatter(\"**\", \"**\")\nparentheses = make_formatter(\"(\", \")\")\n\nprint(f\"html_bold('Hello'): {html_bold('Hello')}\")\nprint(f\"markdown_bold('World'): {markdown_bold('World')}\")\nprint(f\"parentheses('Note'): {parentheses('Note')}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Pattern 4: Rate Limiter (Stateful):\")\nprint(\"=\"*60)\nlimiter = create_rate_limiter(3)\nprint(\"limiter = create_rate_limiter(3)  # Max 3 calls\")\nprint(f\"  Call 1: {limiter()}\")\nprint(f\"  Call 2: {limiter()}\")\nprint(f\"  Call 3: {limiter()}\")\nprint(f\"  Call 4: {limiter()}\")\nprint(f\"  Call 5: {limiter()}\")\nprint(\"State preserved across calls\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Pattern 5: Calculator Factory:\")\nprint(\"=\"*60)\nadd = build_calculator('add')\nmultiply = build_calculator('multiply')\npower = build_calculator('power')\n\nprint(f\"add = build_calculator('add')\")\nprint(f\"  add(5, 3): {add(5, 3)}\")\n\nprint(f\"\\nmultiply = build_calculator('multiply')\")\nprint(f\"  multiply(5, 3): {multiply(5, 3)}\")\n\nprint(f\"\\npower = build_calculator('power')\")\nprint(f\"  power(2, 3): {power(2, 3)}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Pattern 6: Simple Cache:\")\nprint(\"=\"*60)\ncache = make_cache()\nprint(\"cache = make_cache()\")\ncache['set']('user_1', 'Alice')\ncache['set']('user_2', 'Bob')\nprint(f\"  Set user_1: Alice\")\nprint(f\"  Set user_2: Bob\")\nprint(f\"  Get user_1: {cache['get']('user_1')}\")\nprint(f\"  Get user_2: {cache['get']('user_2')}\")\nprint(f\"  Has user_1: {cache['has']('user_1')}\")\nprint(f\"  Has user_3: {cache['has']('user_3')}\")\nprint(\"Cache data hidden in closure\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Closure Pattern Benefits:\")\nprint(\"=\"*60)\nprint(\"1. Data Privacy: Encapsulated state\")\nprint(\"2. Function Customization: Create specialized versions\")\nprint(\"3. Configuration: Bake in settings\")\nprint(\"4. Stateful Behavior: Maintain state across calls\")\nprint(\"5. Factory Pattern: Generate similar functions\")\nprint(\"6. Callback Context: Pass context to callbacks\")\nprint(\"\\nReal-World Uses:\")\nprint(\"  - Event handlers with context\")\nprint(\"  - Partial application\")\nprint(\"  - Decorators\")\nprint(\"  - API client builders\")\nprint(\"  - Memoization/caching\")",
  "solution": "def make_multiplier(factor):\n    \"\"\"Create function that multiplies by factor.\"\"\"\n    def multiply(x):\n        return x * factor\n    return multiply\n\ndef create_validator(min_val, max_val):\n    \"\"\"Create range validator function.\"\"\"\n    def validate(value):\n        return min_val <= value <= max_val\n    return validate\n\ndef make_formatter(prefix, suffix):\n    \"\"\"Create string formatter with prefix/suffix.\"\"\"\n    def format_string(text):\n        return f\"{prefix}{text}{suffix}\"\n    return format_string\n\ndef create_rate_limiter(max_calls):\n    \"\"\"Create rate limiter (simplified).\"\"\"\n    call_count = 0\n    \n    def can_call():\n        nonlocal call_count\n        if call_count < max_calls:\n            call_count += 1\n            return True\n        return False\n    \n    return can_call\n\ndef build_calculator(operator):\n    \"\"\"Create calculator for specific operation.\"\"\"\n    if operator == 'add':\n        return lambda x, y: x + y\n    elif operator == 'multiply':\n        return lambda x, y: x * y\n    elif operator == 'power':\n        return lambda x, y: x ** y\n    else:\n        return lambda x, y: 0\n\ndef make_cache():\n    \"\"\"Create simple memoization cache.\"\"\"\n    cache = {}\n    \n    def get(key):\n        return cache.get(key)\n    \n    def set_value(key, value):\n        cache[key] = value\n    \n    def has(key):\n        return key in cache\n    \n    return {'get': get, 'set': set_value, 'has': has}\n\n# Test code as provided",
  "hints": [
    "Function factory: Outer function returns inner function",
    "Closure remembers: Inner function accesses outer variables",
    "Stateful closures: Use nonlocal to modify state",
    "Configuration builder: Bake settings into returned function",
    "Data privacy: Variables hidden in closure scope",
    "Each factory call creates independent closure with own state"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Multiplier factory",
      "input": "make_multiplier(4)(5)",
      "expectedOutput": "20",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Validator factory",
      "input": "create_validator(0, 100)(50)",
      "expectedOutput": "True",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Formatter factory",
      "input": "make_formatter('[', ']')('test')",
      "expectedOutput": "'[test]'",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Rate limiter",
      "input": "lim = create_rate_limiter(2); lim(); lim(); lim()",
      "expectedOutput": "False",
      "isHidden": true
    },
    {
      "id": "tc5",
      "description": "Calculator factory",
      "input": "build_calculator('add')(10, 5)",
      "expectedOutput": "15",
      "isHidden": true
    },
    {
      "id": "tc6",
      "description": "Cache pattern",
      "input": "c = make_cache(); c['set']('k', 'v'); c['get']('k')",
      "expectedOutput": "'v'",
      "isHidden": true
    }
  ]
}