{
  "id": "exercise-114-function-best-practices",
  "lessonId": "lesson-104-function-best-practices",
  "title": "Clean Code - Function Design Principles",
  "description": "Master professional function design patterns. Write clean, maintainable, testable code.\n\nYour program should:\n1. Follow Single Responsibility Principle\n2. Keep functions short (under 20 lines)\n3. Use descriptive function names\n4. Limit function parameters (max 3-4)\n5. Avoid side effects\n6. Return early to reduce nesting\n\nImplement these functions:\n- `validate_user_input(data)`: Validate with early returns\n- `calculate_price(base, discount)`: Pure function\n- `process_order(order_data)`: Single responsibility\n- `format_user_display(user)`: Guard clauses\n- `find_eligible_users(users, criteria)`: Filter pattern\n- `create_report(data, options)`: Options dict pattern\n\nExample:\n```python\nuser = validate_user_input({'email': 'test@example.com'})\n# Returns dict or raises ValueError\n```",
  "difficulty": "intermediate",
  "points": 20,
  "language": "python",
  "starterCode": "def validate_user_input(data):\n    \"\"\"Validate user input with early returns.\n    \n    Args:\n        data: Dict with 'email' and optional 'age'.\n    \n    Returns:\n        Dict with validated data.\n    \n    Raises:\n        ValueError: If validation fails.\n    \"\"\"\n    # TODO: Use guard clauses (early returns)\n    # if not isinstance(data, dict):\n    #     raise ValueError(\"Data must be dict\")\n    # \n    # if 'email' not in data:\n    #     raise ValueError(\"Email required\")\n    # \n    # email = data['email']\n    # if '@' not in email or '.' not in email:\n    #     raise ValueError(\"Invalid email format\")\n    # \n    # if 'age' in data:\n    #     age = data['age']\n    #     if not isinstance(age, int) or age < 0 or age > 150:\n    #         raise ValueError(\"Invalid age\")\n    # \n    # return data\n    \n    pass\n\ndef calculate_price(base_price, discount_percent=0):\n    \"\"\"Calculate final price (pure function - no side effects).\n    \n    Args:\n        base_price: Original price.\n        discount_percent: Discount percentage (0-100).\n    \n    Returns:\n        Final price after discount.\n    \n    Raises:\n        ValueError: If invalid inputs.\n    \"\"\"\n    # TODO: Validate inputs, calculate result\n    # if base_price < 0:\n    #     raise ValueError(\"Price cannot be negative\")\n    # \n    # if discount_percent < 0 or discount_percent > 100:\n    #     raise ValueError(\"Discount must be 0-100\")\n    # \n    # discount_amount = base_price * (discount_percent / 100)\n    # return base_price - discount_amount\n    \n    pass\n\ndef process_order(order_data):\n    \"\"\"Process order (single responsibility).\n    \n    Args:\n        order_data: Dict with 'items' (list) and 'discount' (float).\n    \n    Returns:\n        Dict with 'subtotal', 'discount', 'total'.\n    \"\"\"\n    # TODO: Calculate subtotal, apply discount, return result\n    # Responsibility: Calculate order totals only\n    # Don't save to DB, send emails, etc. here\n    # \n    # if not isinstance(order_data, dict):\n    #     raise ValueError(\"Order data must be dict\")\n    # \n    # items = order_data.get('items', [])\n    # discount = order_data.get('discount', 0)\n    # \n    # subtotal = sum(item.get('price', 0) for item in items)\n    # discount_amount = subtotal * discount\n    # total = subtotal - discount_amount\n    # \n    # return {\n    #     'subtotal': subtotal,\n    #     'discount': discount_amount,\n    #     'total': total\n    # }\n    \n    pass\n\ndef format_user_display(user):\n    \"\"\"Format user for display with guard clauses.\n    \n    Args:\n        user: Dict with 'name', optional 'email', 'age'.\n    \n    Returns:\n        Formatted string.\n    \"\"\"\n    # TODO: Use guard clauses to handle missing fields\n    # if not user:\n    #     return \"No user\"\n    # \n    # if 'name' not in user:\n    #     return \"Unknown user\"\n    # \n    # name = user['name']\n    # email = user.get('email', 'No email')\n    # age = user.get('age', 'Unknown age')\n    # \n    # return f\"{name} ({email}) - Age: {age}\"\n    \n    pass\n\ndef find_eligible_users(users, min_age=18):\n    \"\"\"Filter users by criteria (simple filter pattern).\n    \n    Args:\n        users: List of user dicts with 'age'.\n        min_age: Minimum age requirement.\n    \n    Returns:\n        List of eligible users.\n    \"\"\"\n    # TODO: Filter users meeting criteria\n    # return [\n    #     user for user in users\n    #     if user.get('age', 0) >= min_age\n    # ]\n    \n    pass\n\ndef create_report(data, options=None):\n    \"\"\"Create report with options dict pattern.\n    \n    Args:\n        data: List of numbers to report on.\n        options: Dict with 'include_sum', 'include_avg', 'include_count'.\n    \n    Returns:\n        Dict with requested calculations.\n    \"\"\"\n    # TODO: Use options dict to control behavior\n    # if options is None:\n    #     options = {}\n    # \n    # result = {}\n    # \n    # if options.get('include_count', True):\n    #     result['count'] = len(data)\n    # \n    # if options.get('include_sum', True):\n    #     result['sum'] = sum(data)\n    # \n    # if options.get('include_avg', True):\n    #     result['avg'] = sum(data) / len(data) if data else 0\n    # \n    # return result\n    \n    pass\n\n# Test functions\nprint(\"Best Practice: Guard Clauses (Early Returns)\")\nprint(\"=\"*60)\ntry:\n    valid = validate_user_input({'email': 'test@example.com', 'age': 25})\n    print(f\"Valid input: {valid}\")\nexcept ValueError as e:\n    print(f\"Error: {e}\")\n\ntry:\n    invalid = validate_user_input({'name': 'Alice'})\n    print(f\"This shouldn't print\")\nexcept ValueError as e:\n    print(f\"Caught error (expected): {e}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Best Practice: Pure Functions (No Side Effects)\")\nprint(\"=\"*60)\nprice1 = calculate_price(100, 10)\nprint(f\"calculate_price(100, 10): ${price1:.2f}\")\n\nprice2 = calculate_price(100, 10)\nprint(f\"Call again: ${price2:.2f}\")\nprint(\"Pure function: Same input → Same output, no side effects\")\n\nprice3 = calculate_price(50, 20)\nprint(f\"calculate_price(50, 20): ${price3:.2f}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Best Practice: Single Responsibility\")\nprint(\"=\"*60)\norder = {\n    'items': [\n        {'name': 'Product A', 'price': 10},\n        {'name': 'Product B', 'price': 20},\n        {'name': 'Product C', 'price': 15}\n    ],\n    'discount': 0.1\n}\n\nresult = process_order(order)\nprint(\"Order processing (calculation only):\")\nprint(f\"  Subtotal: ${result['subtotal']:.2f}\")\nprint(f\"  Discount: ${result['discount']:.2f}\")\nprint(f\"  Total: ${result['total']:.2f}\")\nprint(\"\\nNote: Doesn't save to DB, send emails, etc.\")\nprint(\"Separate concerns → easier testing\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Best Practice: Guard Clauses\")\nprint(\"=\"*60)\nuser1 = {'name': 'Alice', 'email': 'alice@example.com', 'age': 30}\nprint(f\"Full user: {format_user_display(user1)}\")\n\nuser2 = {'name': 'Bob'}\nprint(f\"Partial user: {format_user_display(user2)}\")\n\nuser3 = {}\nprint(f\"Empty dict: {format_user_display(user3)}\")\n\nuser4 = None\nprint(f\"None: {format_user_display(user4)}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Best Practice: Simple Filter Pattern\")\nprint(\"=\"*60)\nusers = [\n    {'name': 'Alice', 'age': 25},\n    {'name': 'Bob', 'age': 17},\n    {'name': 'Charlie', 'age': 30},\n    {'name': 'Diana', 'age': 16}\n]\n\neligible = find_eligible_users(users, min_age=18)\nprint(f\"Users 18+: {[u['name'] for u in eligible]}\")\n\neligible_21 = find_eligible_users(users, min_age=21)\nprint(f\"Users 21+: {[u['name'] for u in eligible_21]}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Best Practice: Options Dict Pattern\")\nprint(\"=\"*60)\ndata = [10, 20, 30, 40, 50]\n\nreport1 = create_report(data)\nprint(f\"Default report: {report1}\")\n\nreport2 = create_report(data, {'include_sum': True, 'include_avg': False})\nprint(f\"Custom report (sum only): {report2}\")\n\nreport3 = create_report(data, {'include_count': True, 'include_sum': False, 'include_avg': True})\nprint(f\"Custom report (count + avg): {report3}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Function Design Principles Summary:\")\nprint(\"=\"*60)\nprint(\"1. Single Responsibility: One function, one purpose\")\nprint(\"2. Guard Clauses: Early returns reduce nesting\")\nprint(\"3. Pure Functions: No side effects, predictable\")\nprint(\"4. Short Functions: Under 20 lines ideal\")\nprint(\"5. Descriptive Names: Say what they do\")\nprint(\"6. Limit Parameters: Max 3-4, use dicts for more\")\nprint(\"7. Options Pattern: Flexible without many params\")\nprint(\"8. Avoid Side Effects: Don't modify global state\")\nprint(\"\\nBenefits:\")\nprint(\"  - Easier to test\")\nprint(\"  - Easier to understand\")\nprint(\"  - Easier to maintain\")\nprint(\"  - Easier to reuse\")",
  "solution": "def validate_user_input(data):\n    \"\"\"Validate user input with early returns.\"\"\"\n    if not isinstance(data, dict):\n        raise ValueError(\"Data must be dict\")\n    \n    if 'email' not in data:\n        raise ValueError(\"Email required\")\n    \n    email = data['email']\n    if '@' not in email or '.' not in email:\n        raise ValueError(\"Invalid email format\")\n    \n    if 'age' in data:\n        age = data['age']\n        if not isinstance(age, int) or age < 0 or age > 150:\n            raise ValueError(\"Invalid age\")\n    \n    return data\n\ndef calculate_price(base_price, discount_percent=0):\n    \"\"\"Calculate final price (pure function - no side effects).\"\"\"\n    if base_price < 0:\n        raise ValueError(\"Price cannot be negative\")\n    \n    if discount_percent < 0 or discount_percent > 100:\n        raise ValueError(\"Discount must be 0-100\")\n    \n    discount_amount = base_price * (discount_percent / 100)\n    return base_price - discount_amount\n\ndef process_order(order_data):\n    \"\"\"Process order (single responsibility).\"\"\"\n    if not isinstance(order_data, dict):\n        raise ValueError(\"Order data must be dict\")\n    \n    items = order_data.get('items', [])\n    discount = order_data.get('discount', 0)\n    \n    subtotal = sum(item.get('price', 0) for item in items)\n    discount_amount = subtotal * discount\n    total = subtotal - discount_amount\n    \n    return {\n        'subtotal': subtotal,\n        'discount': discount_amount,\n        'total': total\n    }\n\ndef format_user_display(user):\n    \"\"\"Format user for display with guard clauses.\"\"\"\n    if not user:\n        return \"No user\"\n    \n    if 'name' not in user:\n        return \"Unknown user\"\n    \n    name = user['name']\n    email = user.get('email', 'No email')\n    age = user.get('age', 'Unknown age')\n    \n    return f\"{name} ({email}) - Age: {age}\"\n\ndef find_eligible_users(users, min_age=18):\n    \"\"\"Filter users by criteria (simple filter pattern).\"\"\"\n    return [\n        user for user in users\n        if user.get('age', 0) >= min_age\n    ]\n\ndef create_report(data, options=None):\n    \"\"\"Create report with options dict pattern.\"\"\"\n    if options is None:\n        options = {}\n    \n    result = {}\n    \n    if options.get('include_count', True):\n        result['count'] = len(data)\n    \n    if options.get('include_sum', True):\n        result['sum'] = sum(data)\n    \n    if options.get('include_avg', True):\n        result['avg'] = sum(data) / len(data) if data else 0\n    \n    return result\n\n# Test code as provided",
  "hints": [
    "Single Responsibility: Function does ONE thing well",
    "Guard clauses: Return early to avoid nested if statements",
    "Pure functions: Same input → same output, no side effects",
    "Options dict: Better than many optional parameters",
    "Descriptive names: Function name should explain purpose",
    "Keep functions short: Under 20 lines when possible"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Validate valid input",
      "input": "validate_user_input({'email': 'test@example.com', 'age': 25})",
      "expectedOutput": "{'email': 'test@example.com', 'age': 25}",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Pure function - calculate price",
      "input": "calculate_price(100, 20)",
      "expectedOutput": "80.0",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Process order single responsibility",
      "input": "process_order({'items': [{'price': 10}, {'price': 20}], 'discount': 0.1})['total']",
      "expectedOutput": "27.0",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Guard clauses - handle missing data",
      "input": "format_user_display(None)",
      "expectedOutput": "'No user'",
      "isHidden": true
    },
    {
      "id": "tc5",
      "description": "Filter pattern",
      "input": "len(find_eligible_users([{'age': 17}, {'age': 25}, {'age': 30}], 18))",
      "expectedOutput": "2",
      "isHidden": true
    },
    {
      "id": "tc6",
      "description": "Options dict pattern",
      "input": "create_report([10, 20, 30], {'include_sum': True, 'include_avg': False})['sum']",
      "expectedOutput": "60",
      "isHidden": true
    }
  ]
}