{
  "id": "exercise-111-infinite-loops",
  "lessonId": "lesson-101-infinite-loops",
  "title": "Controlled Infinite Loop Systems",
  "description": "Master intentional infinite loops with proper control mechanisms. Learn when and how to use infinite loops safely.\n\nYour program should:\n1. Create intentional infinite loops\n2. Implement exit conditions\n3. Build game loops and servers\n4. Handle user input loops\n5. Use sentinel values and flags\n\nImplement these functions:\n- `menu_loop(commands)`: Menu system with exit option\n- `game_loop_simulator(max_turns)`: Game loop with turn limit\n- `input_until_valid(validator)`: Retry until valid input\n- `process_until_sentinel(items, sentinel)`: Process until sentinel\n- `rate_limited_loop(callback, max_iterations, delay)`: Controlled iteration\n- `state_machine_loop(states, start_state)`: State machine loop\n\nExample:\n```python\nwhile True:\n    action = get_action()\n    if action == 'quit':\n        break\n```",
  "difficulty": "intermediate",
  "points": 20,
  "language": "python",
  "starterCode": "def menu_loop(commands):\n    \"\"\"Simulate menu loop that runs until 'exit' command.\n    Returns list of executed commands.\"\"\"\n    # TODO: Process commands until 'exit'\n    # executed = []\n    # for cmd in commands:\n    #   if cmd == 'exit':\n    #     break\n    #   executed.append(cmd)\n    # return executed\n    \n    pass\n\ndef game_loop_simulator(max_turns):\n    \"\"\"Simulate game loop for max_turns.\n    Returns list of turn numbers.\"\"\"\n    # TODO: Loop through turns\n    # turns = []\n    # turn = 1\n    # while turn <= max_turns:\n    #   turns.append(turn)\n    #   turn += 1\n    # return turns\n    \n    pass\n\ndef input_until_valid(validator):\n    \"\"\"Simulate input validation loop.\n    validator is function returning True if valid.\n    Returns count of attempts until valid.\"\"\"\n    # TODO: Count attempts\n    # attempts = 0\n    # while True:\n    #   attempts += 1\n    #   if validator(attempts):\n    #     return attempts\n    \n    pass\n\ndef process_until_sentinel(items, sentinel):\n    \"\"\"Process items from list until sentinel is found.\n    Returns list of processed items (before sentinel).\"\"\"\n    # TODO: Stop at sentinel\n    # processed = []\n    # for item in items:\n    #   if item == sentinel:\n    #     break\n    #   processed.append(item * 2)  # Example processing\n    # return processed\n    \n    pass\n\ndef rate_limited_loop(callback, max_iterations, delay):\n    \"\"\"Simulate rate-limited loop.\n    callback is function called each iteration.\n    Returns list of callback results.\"\"\"\n    # TODO: Execute with limit\n    # results = []\n    # iteration = 0\n    # while iteration < max_iterations:\n    #   result = callback(iteration)\n    #   results.append(result)\n    #   iteration += 1\n    #   # In real code: time.sleep(delay)\n    # return results\n    \n    pass\n\ndef state_machine_loop(states, start_state):\n    \"\"\"Simulate state machine loop.\n    states is dict: {state: next_state}\n    Runs until reaching 'end' state.\n    Returns list of visited states.\"\"\"\n    # TODO: Follow state transitions\n    # visited = []\n    # current = start_state\n    # while current != 'end':\n    #   visited.append(current)\n    #   current = states.get(current, 'end')\n    # visited.append('end')\n    # return visited\n    \n    pass\n\n# Test functions\nprint(\"Menu Loop Simulation:\")\nprint(\"=\"*60)\ntest_commands = [\n    ['help', 'list', 'exit', 'save'],  # exit stops processing\n    ['start', 'exit'],\n    ['command1', 'command2', 'command3', 'exit'],\n]\n\nfor commands in test_commands:\n    executed = menu_loop(commands)\n    print(f\"Commands: {commands}\")\n    print(f\"Executed before exit: {executed}\\n\")\n\nprint(\"=\"*60)\nprint(\"Game Loop Simulator:\")\nprint(\"=\"*60)\nfor max_turns in [5, 10, 3]:\n    turns = game_loop_simulator(max_turns)\n    print(f\"Game with {max_turns} turns: {turns}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Input Validation Loop:\")\nprint(\"=\"*60)\n# Validator that passes on 3rd attempt\nvalidator1 = lambda attempt: attempt == 3\nattempts = input_until_valid(validator1)\nprint(f\"Validator (passes on attempt 3): {attempts} attempts\")\n\n# Validator that passes on 1st attempt\nvalidator2 = lambda attempt: attempt == 1\nattempts = input_until_valid(validator2)\nprint(f\"Validator (passes immediately): {attempts} attempts\")\n\n# Validator that passes on 5th attempt\nvalidator3 = lambda attempt: attempt == 5\nattempts = input_until_valid(validator3)\nprint(f\"Validator (passes on attempt 5): {attempts} attempts\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Process Until Sentinel:\")\nprint(\"=\"*60)\ntest_cases = [\n    ([1, 2, 3, 'STOP', 4, 5], 'STOP'),\n    ([10, 20, 30], 'STOP'),  # No sentinel\n    (['a', 'b', 'END', 'c'], 'END'),\n]\n\nfor items, sentinel in test_cases:\n    processed = process_until_sentinel(items, sentinel)\n    print(f\"Items: {items}\")\n    print(f\"Sentinel: {sentinel}\")\n    print(f\"Processed (doubled): {processed}\\n\")\n\nprint(\"=\"*60)\nprint(\"Rate-Limited Loop:\")\nprint(\"=\"*60)\n# Callback that returns iteration squared\ncallback1 = lambda i: i ** 2\nresults = rate_limited_loop(callback1, 5, 0.1)\nprint(f\"Squared values (5 iterations): {results}\")\n\n# Callback that returns iteration doubled\ncallback2 = lambda i: i * 2\nresults = rate_limited_loop(callback2, 7, 0.05)\nprint(f\"Doubled values (7 iterations): {results}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"State Machine Loop:\")\nprint(\"=\"*60)\nstates1 = {\n    'start': 'processing',\n    'processing': 'validating',\n    'validating': 'complete',\n    'complete': 'end'\n}\nvisited = state_machine_loop(states1, 'start')\nprint(f\"State machine 1: {' -> '.join(visited)}\")\n\nstates2 = {\n    'idle': 'active',\n    'active': 'paused',\n    'paused': 'active',  # Could loop, but we limit it\n}\n# This would loop forever between active/paused without limit\n# For demo, set paused to end\nstates2['paused'] = 'end'\nvisited = state_machine_loop(states2, 'idle')\nprint(f\"State machine 2: {' -> '.join(visited)}\")\n\nstates3 = {\n    'init': 'ready',\n    'ready': 'end'\n}\nvisited = state_machine_loop(states3, 'init')\nprint(f\"State machine 3: {' -> '.join(visited)}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Infinite Loop Safety:\")\nprint(\"=\"*60)\nprint(\"Best Practices:\")\nprint(\"1. Always have clear exit condition\")\nprint(\"2. Use break, return, or flag to exit\")\nprint(\"3. Avoid infinite loops without control\")\nprint(\"4. Test exit conditions thoroughly\")\nprint(\"5. Use while True with explicit break\")\nprint(\"6. Consider timeout or max iteration limits\")",
  "solution": "def menu_loop(commands):\n    \"\"\"Simulate menu loop that runs until 'exit' command.\n    Returns list of executed commands.\"\"\"\n    executed = []\n    for cmd in commands:\n        if cmd == 'exit':\n            break\n        executed.append(cmd)\n    return executed\n\ndef game_loop_simulator(max_turns):\n    \"\"\"Simulate game loop for max_turns.\n    Returns list of turn numbers.\"\"\"\n    turns = []\n    turn = 1\n    while turn <= max_turns:\n        turns.append(turn)\n        turn += 1\n    return turns\n\ndef input_until_valid(validator):\n    \"\"\"Simulate input validation loop.\n    validator is function returning True if valid.\n    Returns count of attempts until valid.\"\"\"\n    attempts = 0\n    while True:\n        attempts += 1\n        if validator(attempts):\n            return attempts\n\ndef process_until_sentinel(items, sentinel):\n    \"\"\"Process items from list until sentinel is found.\n    Returns list of processed items (before sentinel).\"\"\"\n    processed = []\n    for item in items:\n        if item == sentinel:\n            break\n        processed.append(item * 2)\n    return processed\n\ndef rate_limited_loop(callback, max_iterations, delay):\n    \"\"\"Simulate rate-limited loop.\n    callback is function called each iteration.\n    Returns list of callback results.\"\"\"\n    results = []\n    iteration = 0\n    while iteration < max_iterations:\n        result = callback(iteration)\n        results.append(result)\n        iteration += 1\n    return results\n\ndef state_machine_loop(states, start_state):\n    \"\"\"Simulate state machine loop.\n    states is dict: {state: next_state}\n    Runs until reaching 'end' state.\n    Returns list of visited states.\"\"\"\n    visited = []\n    current = start_state\n    while current != 'end':\n        visited.append(current)\n        current = states.get(current, 'end')\n    visited.append('end')\n    return visited\n\n# Test code as provided",
  "hints": [
    "Use while True for intentional infinite loops",
    "Always include break or return for exit",
    "Sentinel values: special markers to stop processing",
    "Flag variables: bool to control loop continuation",
    "State machines: transition through states until end",
    "Add max iteration limits for safety"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Menu loop exits properly",
      "input": "menu_loop(['help', 'list', 'exit', 'save'])",
      "expectedOutput": "['help', 'list']",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Game loop runs correct turns",
      "input": "game_loop_simulator(3)",
      "expectedOutput": "[1, 2, 3]",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Input validation attempts",
      "input": "input_until_valid(lambda x: x == 2)",
      "expectedOutput": "2",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Process until sentinel",
      "input": "process_until_sentinel([1, 2, 'STOP', 3], 'STOP')",
      "expectedOutput": "[2, 4]",
      "isHidden": true
    },
    {
      "id": "tc5",
      "description": "Rate-limited loop",
      "input": "rate_limited_loop(lambda i: i * 2, 4, 0.1)",
      "expectedOutput": "[0, 2, 4, 6]",
      "isHidden": true
    },
    {
      "id": "tc6",
      "description": "State machine transitions",
      "input": "state_machine_loop({'start': 'end'}, 'start')",
      "expectedOutput": "['start', 'end']",
      "isHidden": true
    }
  ]
}