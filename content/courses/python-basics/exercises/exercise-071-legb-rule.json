{
  "id": "exercise-071-legb-rule",
  "lessonId": "lesson-057-legb-rule",
  "title": "Mastering the LEGB Scope Resolution Rule",
  "description": "Deep dive into Python's LEGB scope resolution rule. Predict and control variable lookup.\n\nYour program should:\n1. Master the four scopes: Local, Enclosing, Global, Built-in\n2. Predict variable resolution order\n3. Understand variable shadowing at each level\n4. Debug scope-related issues\n5. Apply LEGB in complex nested scenarios\n6. Know when each scope level is searched\n\nImplement these functions:\n- `local_scope_demo()`: Demonstrate local scope priority\n- `enclosing_scope_demo()`: Show enclosing scope search\n- `global_scope_demo()`: Demonstrate global scope access\n- `builtin_scope_demo()`: Use built-in scope functions\n- `complete_legb_demo()`: Show all four scopes\n- `scope_prediction(x)`: Predict which scope resolves x\n\nExample:\n```python\ncomplete_legb_demo()  # Shows L, E, G, B resolution\n```",
  "difficulty": "intermediate",
  "points": 20,
  "language": "python",
  "starterCode": "# Global variable\nx = \"Global X\"\n\ndef local_scope_demo():\n    \"\"\"Demonstrate local scope takes priority.\n    \n    Returns:\n        String showing local x value.\n    \"\"\"\n    # TODO: Local scope shadows all others\n    # x = \"Local X\"  # L - Found first!\n    # return x\n    \n    pass\n\ndef enclosing_scope_demo():\n    \"\"\"Demonstrate enclosing scope search.\n    \n    Returns:\n        Value from enclosing scope.\n    \"\"\"\n    # TODO: Enclosing scope searched after local\n    # y = \"Enclosing Y\"\n    # \n    # def inner():\n    #     # No local y, search enclosing\n    #     return y  # E - Found in enclosing\n    # \n    # return inner()\n    \n    pass\n\ndef global_scope_demo():\n    \"\"\"Demonstrate global scope access.\n    \n    Returns:\n        Value from global scope.\n    \"\"\"\n    # TODO: Global searched after local and enclosing\n    # def inner():\n    #     # No local or enclosing x, search global\n    #     return x  # G - Found in global\n    # \n    # return inner()\n    \n    pass\n\ndef builtin_scope_demo():\n    \"\"\"Demonstrate built-in scope access.\n    \n    Returns:\n        Dictionary with built-in function results.\n    \"\"\"\n    # TODO: Built-in searched last\n    # # len, max, sum are built-in (no import needed)\n    # data = [1, 2, 3, 4, 5]\n    # return {\n    #     'len': len(data),    # B - Built-in\n    #     'max': max(data),    # B - Built-in\n    #     'abs': abs(-10)      # B - Built-in\n    # }\n    \n    pass\n\ndef complete_legb_demo():\n    \"\"\"Show all four LEGB scopes.\n    \n    Returns:\n        Dictionary showing each scope.\n    \"\"\"\n    # TODO: Demonstrate complete LEGB\n    # e_var = \"Enclosing\"\n    # \n    # def inner():\n    #     l_var = \"Local\"\n    #     return {\n    #         'L': l_var,           # Local\n    #         'E': e_var,           # Enclosing\n    #         'G': x,               # Global (module x)\n    #         'B': str(len([1]))    # Built-in (len function)\n    #     }\n    # \n    # return inner()\n    \n    pass\n\ndef scope_prediction(test_value):\n    \"\"\"Predict which scope resolves variable.\n    \n    Args:\n        test_value: Value for testing.\n    \n    Returns:\n        Dictionary showing scope resolution.\n    \"\"\"\n    # TODO: Show shadowing and resolution\n    # # Global x exists\n    # outer_x = \"Enclosing level\"\n    # \n    # def level1():\n    #     def level2():\n    #         # x resolved from global (no local/enclosing x)\n    #         # outer_x resolved from enclosing\n    #         # len resolved from built-in\n    #         return {\n    #             'global_x': x,\n    #             'enclosing_x': outer_x,\n    #             'builtin_len': len([1, 2]),\n    #             'local_test': test_value\n    #         }\n    #     return level2()\n    # \n    # return level1()\n    \n    pass\n\n# Test functions\nprint(\"LEGB Rule: Local → Enclosing → Global → Built-in\")\nprint(\"=\"*60)\n\nprint(\"\\nL - Local Scope:\")\nprint(\"-\"*60)\nprint(f\"Global x: {x}\")\nprint(f\"local_scope_demo(): {local_scope_demo()}\")\nprint(\"Local scope takes priority (shadows global)\")\n\nprint(\"\\nE - Enclosing Scope:\")\nprint(\"-\"*60)\nprint(f\"enclosing_scope_demo(): {enclosing_scope_demo()}\")\nprint(\"Inner function found variable in enclosing function\")\n\nprint(\"\\nG - Global Scope:\")\nprint(\"-\"*60)\nprint(f\"global_scope_demo(): {global_scope_demo()}\")\nprint(\"No local/enclosing, found in global (module level)\")\n\nprint(\"\\nB - Built-in Scope:\")\nprint(\"-\"*60)\nbuiltins = builtin_scope_demo()\nprint(f\"len([1,2,3,4,5]): {builtins['len']}\")\nprint(f\"max([1,2,3,4,5]): {builtins['max']}\")\nprint(f\"abs(-10): {builtins['abs']}\")\nprint(\"Built-in functions always available (searched last)\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Complete LEGB Demonstration:\")\nprint(\"=\"*60)\nlegb = complete_legb_demo()\nfor scope, value in legb.items():\n    scope_names = {\n        'L': 'Local',\n        'E': 'Enclosing',\n        'G': 'Global',\n        'B': 'Built-in'\n    }\n    print(f\"{scope} ({scope_names[scope]}): {value}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Scope Prediction:\")\nprint(\"=\"*60)\nprediction = scope_prediction(\"Test param\")\nfor key, value in prediction.items():\n    print(f\"{key}: {value}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"LEGB Rule Summary:\")\nprint(\"=\"*60)\nprint(\"Search Order:\")\nprint(\"  1. L (Local): Current function\")\nprint(\"  2. E (Enclosing): Outer function(s)\")\nprint(\"  3. G (Global): Module level\")\nprint(\"  4. B (Built-in): Python built-ins\")\nprint(\"\\nKey Points:\")\nprint(\"  - First match wins\")\nprint(\"  - Inner scopes shadow outer scopes\")\nprint(\"  - NameError if not found in any scope\")\nprint(\"  - Built-ins always available\")\nprint(\"  - Can't skip levels (searches in order)\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Common Patterns:\")\nprint(\"=\"*60)\nprint(\"Local shadows enclosing:\")\nprint(\"  def outer():\")\nprint(\"      x = 1\")\nprint(\"      def inner():\")\nprint(\"          x = 2  # Shadows outer's x\")\nprint(\"\\nAccess enclosing:\")\nprint(\"  def outer():\")\nprint(\"      x = 1\")\nprint(\"      def inner():\")\nprint(\"          return x  # Uses outer's x\")\nprint(\"\\nModify enclosing:\")\nprint(\"  def outer():\")\nprint(\"      x = 1\")\nprint(\"      def inner():\")\nprint(\"          nonlocal x  # Modify outer's x\")\nprint(\"          x = 2\")",
  "solution": "# Global variable\nx = \"Global X\"\n\ndef local_scope_demo():\n    \"\"\"Demonstrate local scope takes priority.\"\"\"\n    x = \"Local X\"\n    return x\n\ndef enclosing_scope_demo():\n    \"\"\"Demonstrate enclosing scope search.\"\"\"\n    y = \"Enclosing Y\"\n    \n    def inner():\n        return y\n    \n    return inner()\n\ndef global_scope_demo():\n    \"\"\"Demonstrate global scope access.\"\"\"\n    def inner():\n        return x\n    \n    return inner()\n\ndef builtin_scope_demo():\n    \"\"\"Demonstrate built-in scope access.\"\"\"\n    data = [1, 2, 3, 4, 5]\n    return {\n        'len': len(data),\n        'max': max(data),\n        'abs': abs(-10)\n    }\n\ndef complete_legb_demo():\n    \"\"\"Show all four LEGB scopes.\"\"\"\n    e_var = \"Enclosing\"\n    \n    def inner():\n        l_var = \"Local\"\n        return {\n            'L': l_var,\n            'E': e_var,\n            'G': x,\n            'B': str(len([1]))\n        }\n    \n    return inner()\n\ndef scope_prediction(test_value):\n    \"\"\"Predict which scope resolves variable.\"\"\"\n    outer_x = \"Enclosing level\"\n    \n    def level1():\n        def level2():\n            return {\n                'global_x': x,\n                'enclosing_x': outer_x,\n                'builtin_len': len([1, 2]),\n                'local_test': test_value\n            }\n        return level2()\n    \n    return level1()\n\n# Test code as provided",
  "hints": [
    "LEGB search order: Local first, then Enclosing, then Global, then Built-in",
    "First match wins - stops searching after finding variable",
    "Local scope: Variables defined in current function",
    "Enclosing scope: Variables from outer function(s)",
    "Global scope: Module-level variables",
    "Built-in scope: Python's built-in functions (len, max, sum, etc.)"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Local scope priority",
      "input": "local_scope_demo()",
      "expectedOutput": "'Local X'",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Enclosing scope access",
      "input": "enclosing_scope_demo()",
      "expectedOutput": "'Enclosing Y'",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Global scope access",
      "input": "global_scope_demo()",
      "expectedOutput": "'Global X'",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Built-in scope",
      "input": "builtin_scope_demo()['len']",
      "expectedOutput": "5",
      "isHidden": true
    },
    {
      "id": "tc5",
      "description": "Complete LEGB",
      "input": "complete_legb_demo()['E']",
      "expectedOutput": "'Enclosing'",
      "isHidden": true
    },
    {
      "id": "tc6",
      "description": "Scope prediction",
      "input": "scope_prediction('test')['builtin_len']",
      "expectedOutput": "2",
      "isHidden": true
    }
  ]
}