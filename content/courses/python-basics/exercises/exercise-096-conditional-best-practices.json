{
  "id": "exercise-096-conditional-best-practices",
  "lessonId": "lesson-088-conditional-best-practices",
  "title": "Code Refactoring Workshop",
  "description": "Refactor poorly-written conditional code following industry best practices for readability and maintainability.\n\nYour program should:\n1. Extract complex conditions into meaningful variables\n2. Replace magic numbers with named constants\n3. Simplify nested conditionals with guard clauses\n4. Use positive conditions instead of double negatives\n5. Ensure consistent return types\n\nImplement these functions:\n- `refactor_nested_to_guards(user, order)`: Convert nested ifs to guards\n- `extract_complex_condition(data)`: Break down complex boolean expressions\n- `replace_magic_numbers(age)`: Use named constants\n- `simplify_boolean_logic(value)`: Remove redundant boolean checks\n- `validate_with_early_returns(data)`: Implement guard pattern\n\nExample:\n```python\nresult = refactor_nested_to_guards({'id': 1}, {'total': 100})\n# Returns clean result with early returns\n```",
  "difficulty": "intermediate",
  "points": 20,
  "language": "python",
  "starterCode": "# Define constants at module level\nCHILD_MAX_AGE = 12\nTEEN_MAX_AGE = 19\nADULT_MAX_AGE = 64\nMIN_ORDER_AMOUNT = 10\nFREE_SHIPPING_THRESHOLD = 50\n\ndef refactor_nested_to_guards(user, order):\n    \"\"\"Refactor deeply nested conditionals to guard clauses.\"\"\"\n    # TODO: Refactor this nested code to use guard clauses:\n    # Original (nested version - don't implement this!):\n    # if user:\n    #     if user.get('id'):\n    #         if order:\n    #             if order.get('total', 0) > 0:\n    #                 return 'Order processed'\n    # return 'Error'\n    #\n    # Refactored version should check invalid cases first and return early\n    # Guard 1: Check user exists\n    # Guard 2: Check user has id\n    # Guard 3: Check order exists\n    # Guard 4: Check order has valid total\n    # Then return success\n    \n    pass\n\ndef extract_complex_condition(data):\n    \"\"\"Extract complex condition into named variables.\"\"\"\n    # TODO: Refactor this complex condition:\n    # Bad: if data.get('age', 0) >= 18 and data.get('email') and '@' in data.get('email', '') and data.get('consent', False):\n    #\n    # Extract to clear variables:\n    # is_adult = ...\n    # has_email = ...\n    # email_valid = ...\n    # has_consent = ...\n    # Then combine: return is_adult and has_email and email_valid and has_consent\n    \n    pass\n\ndef replace_magic_numbers(age):\n    \"\"\"Replace magic numbers with named constants.\"\"\"\n    # TODO: Use the constants defined above (CHILD_MAX_AGE, etc.)\n    # Instead of: if age < 13: return 'child'\n    # Use: if age <= CHILD_MAX_AGE: return 'child'\n    # Categories: child (<=12), teen (13-19), adult (20-64), senior (65+)\n    \n    pass\n\ndef simplify_boolean_logic(value):\n    \"\"\"Simplify redundant boolean checks.\"\"\"\n    # TODO: Simplify these redundant patterns:\n    # Bad: if value == True: return True else: return False\n    # Good: return value\n    #\n    # Bad: if value: return True else: return False\n    # Good: return bool(value)\n    #\n    # Just return the boolean value directly\n    # Handle: if value is truthy, return True, else False\n    \n    pass\n\ndef validate_with_early_returns(data):\n    \"\"\"Validate data with early return pattern.\"\"\"\n    # TODO: Implement validation with guard clauses:\n    # Check required fields: 'username', 'email', 'age'\n    # Return error dict {'valid': False, 'error': '...'} for each failure\n    # Validate:\n    # - username: required, min 3 chars, max 20 chars\n    # - email: required, must contain '@'\n    # - age: required, must be >= 13\n    # If all pass: return {'valid': True, 'error': None}\n    \n    pass\n\ndef calculate_shipping_clean(order_total, is_member):\n    \"\"\"Calculate shipping cost with clear logic.\"\"\"\n    # TODO: Use named constants and clear logic:\n    # - Orders < MIN_ORDER_AMOUNT: not eligible\n    # - Orders >= FREE_SHIPPING_THRESHOLD: free shipping\n    # - Members: $5 shipping\n    # - Non-members: $10 shipping\n    # Return shipping cost or error message\n    \n    pass\n\n# Test the functions\nprint(\"Refactored Guard Clauses:\")\nprint(\"=\"*60)\ntest_cases = [\n    (None, {'total': 100}),\n    ({'id': None}, {'total': 100}),\n    ({'id': 1}, None),\n    ({'id': 1}, {'total': 0}),\n    ({'id': 1}, {'total': 100}),\n]\n\nfor user, order in test_cases:\n    result = refactor_nested_to_guards(user, order)\n    print(f\"User: {user}, Order: {order} → {result}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Extracted Complex Conditions:\")\nprint(\"=\"*60)\ntest_data = [\n    {'age': 25, 'email': 'test@example.com', 'consent': True},\n    {'age': 16, 'email': 'test@example.com', 'consent': True},\n    {'age': 25, 'email': 'invalid-email', 'consent': True},\n    {'age': 25, 'email': 'test@example.com', 'consent': False},\n]\n\nfor data in test_data:\n    result = extract_complex_condition(data)\n    print(f\"Data: {data}\")\n    print(f\"Valid: {result}\\n\")\n\nprint(\"=\"*60)\nprint(\"Named Constants (No Magic Numbers):\")\nprint(\"=\"*60)\nages = [8, 15, 30, 70]\nfor age in ages:\n    category = replace_magic_numbers(age)\n    print(f\"Age {age}: {category}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Simplified Boolean Logic:\")\nprint(\"=\"*60)\nvalues = [True, False, 1, 0, 'text', '']\nfor val in values:\n    result = simplify_boolean_logic(val)\n    print(f\"{str(val):10} → {result}\")\n\nprint(\"\\n\" + \"=\"*60)\nprint(\"Early Return Validation:\")\nprint(\"=\"*60)\nvalidation_tests = [\n    {'username': 'alice', 'email': 'alice@example.com', 'age': 25},\n    {'username': 'ab', 'email': 'alice@example.com', 'age': 25},\n    {'username': 'alice', 'email': 'invalid', 'age': 25},\n    {'username': 'alice', 'email': 'alice@example.com', 'age': 10},\n    {},\n]\n\nfor data in validation_tests:\n    result = validate_with_early_returns(data)\n    print(f\"Data: {data}\")\n    print(f\"Result: {result}\\n\")\n\nprint(\"=\"*60)\nprint(\"Clean Shipping Calculation:\")\nprint(\"=\"*60)\nshipping_tests = [\n    (5, False),\n    (30, False),\n    (30, True),\n    (75, False),\n    (75, True),\n]\n\nfor total, is_member in shipping_tests:\n    cost = calculate_shipping_clean(total, is_member)\n    print(f\"Order: ${total}, Member: {is_member} → Shipping: {cost}\")",
  "solution": "# Constants at module level\nCHILD_MAX_AGE = 12\nTEEN_MAX_AGE = 19\nADULT_MAX_AGE = 64\nMIN_ORDER_AMOUNT = 10\nFREE_SHIPPING_THRESHOLD = 50\n\ndef refactor_nested_to_guards(user, order):\n    \"\"\"Refactor deeply nested conditionals to guard clauses.\"\"\"\n    # Guard clauses - check invalid cases first\n    if not user:\n        return 'Error: No user'\n    \n    if not user.get('id'):\n        return 'Error: User has no ID'\n    \n    if not order:\n        return 'Error: No order'\n    \n    if order.get('total', 0) <= 0:\n        return 'Error: Invalid order total'\n    \n    # Happy path\n    return 'Order processed'\n\ndef extract_complex_condition(data):\n    \"\"\"Extract complex condition into named variables.\"\"\"\n    # Extract each condition to meaningful variable\n    is_adult = data.get('age', 0) >= 18\n    has_email = bool(data.get('email'))\n    email_valid = '@' in data.get('email', '')\n    has_consent = data.get('consent', False)\n    \n    # Combine with clear logic\n    return is_adult and has_email and email_valid and has_consent\n\ndef replace_magic_numbers(age):\n    \"\"\"Replace magic numbers with named constants.\"\"\"\n    if age <= CHILD_MAX_AGE:\n        return 'child'\n    elif age <= TEEN_MAX_AGE:\n        return 'teen'\n    elif age <= ADULT_MAX_AGE:\n        return 'adult'\n    else:\n        return 'senior'\n\ndef simplify_boolean_logic(value):\n    \"\"\"Simplify redundant boolean checks.\"\"\"\n    # Direct boolean conversion - no if-else needed\n    return bool(value)\n\ndef validate_with_early_returns(data):\n    \"\"\"Validate data with early return pattern.\"\"\"\n    # Check username\n    if 'username' not in data:\n        return {'valid': False, 'error': 'Username required'}\n    \n    username = data['username']\n    if len(username) < 3:\n        return {'valid': False, 'error': 'Username too short (min 3 chars)'}\n    \n    if len(username) > 20:\n        return {'valid': False, 'error': 'Username too long (max 20 chars)'}\n    \n    # Check email\n    if 'email' not in data:\n        return {'valid': False, 'error': 'Email required'}\n    \n    if '@' not in data['email']:\n        return {'valid': False, 'error': 'Invalid email format'}\n    \n    # Check age\n    if 'age' not in data:\n        return {'valid': False, 'error': 'Age required'}\n    \n    if data['age'] < 13:\n        return {'valid': False, 'error': 'Must be at least 13 years old'}\n    \n    # All validations passed\n    return {'valid': True, 'error': None}\n\ndef calculate_shipping_clean(order_total, is_member):\n    \"\"\"Calculate shipping cost with clear logic.\"\"\"\n    # Guard: minimum order\n    if order_total < MIN_ORDER_AMOUNT:\n        return f'Error: Minimum order ${MIN_ORDER_AMOUNT}'\n    \n    # Free shipping threshold\n    if order_total >= FREE_SHIPPING_THRESHOLD:\n        return 0\n    \n    # Member vs non-member rates\n    return 5 if is_member else 10\n\n# Test code as provided",
  "hints": [
    "Guard clauses: check for invalid cases first and return early",
    "Extract conditions: give each boolean check a meaningful variable name",
    "Named constants: replace hardcoded numbers with descriptive constant names",
    "Simplify booleans: if value: return True else: return False is just return bool(value)",
    "Early returns reduce nesting: exit as soon as you know the answer",
    "Positive conditions are easier to read than double negatives"
  ],
  "testCases": [
    {
      "id": "tc1",
      "description": "Valid user and order processed",
      "input": "refactor_nested_to_guards({'id': 1}, {'total': 100})",
      "expectedOutput": "'Order processed'",
      "isHidden": false
    },
    {
      "id": "tc2",
      "description": "Complex condition extracted correctly",
      "input": "extract_complex_condition({'age': 25, 'email': 'test@ex.com', 'consent': True})",
      "expectedOutput": "True",
      "isHidden": false
    },
    {
      "id": "tc3",
      "description": "Age 15 categorized as teen",
      "input": "replace_magic_numbers(15)",
      "expectedOutput": "'teen'",
      "isHidden": false
    },
    {
      "id": "tc4",
      "description": "Boolean simplification works",
      "input": "simplify_boolean_logic('text')",
      "expectedOutput": "True",
      "isHidden": true
    },
    {
      "id": "tc5",
      "description": "Validation catches short username",
      "input": "validate_with_early_returns({'username': 'ab', 'email': 'a@b.com', 'age': 20})['valid']",
      "expectedOutput": "False",
      "isHidden": true
    },
    {
      "id": "tc6",
      "description": "Free shipping over threshold",
      "input": "calculate_shipping_clean(75, False)",
      "expectedOutput": "0",
      "isHidden": true
    }
  ]
}